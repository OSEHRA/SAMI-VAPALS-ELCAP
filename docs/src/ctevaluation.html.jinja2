{% extends 'layout.jinja2' %}
{% import 'forms.jinja2' as f %}
{% block title %}{{ title | escape }}{% endblock %}

{% block head %}
    <style>
        #nodule-table .form-group-sm {
            margin: 5px 5px 5px 5px;
        }
    </style>
{% endblock %}


{% set noduleArray = range(1,11) %}
{% block body %}
    <div class="container-fluid" style="max-width:1550px">
        <h1>
            Sample, Sammy G
            <small class="text-muted" title="Study ID">ST0001</small>
        </h1>
        <h2>{{ title }}
            <small class="text-muted" title="Medical Record Number">1234567890</small>
        </h2>

        <hr>
        <form action="{{ formPage+".html" if mockup else "/vapals" }}" method="{{ formMethod }}"
              class="validated"
              data-fv-icon-valid="glyphicon glyphicon-ok"
              data-fv-icon-invalid="glyphicon glyphicon-remove"
              data-fv-icon-validating="glyphicon glyphicon-refresh"
              data-fv-button-selector="#submit-button">

            <input type="hidden" name="samiroute" value="postform"/>
            <input type="hidden" name="studyid" value="@@SID@@"/>
            <input type="hidden" name="form" value="@@FORMKEY@@"/>

            <div>
                <!--TABS-->
                <!--  Scan , Nodules, Abnormalities, Follow Up, Impression -->
                <!-- each item contains (Tab Title,tab-html-id) -->
                {% set tab_list = [("Scan","scan"), ("Nodules", "nodules"), ("Emphysema/Coronary Calcifications","emphysema-coronary"),
                            ("Other Abnormalities","abnormalities"), ("Impression & Follow Up","impression")] -%}

                <ul class="nav nav-tabs" id="ctEvalTabs" role="tablist" style="margin-bottom: 15px;">
                    {% for tab_name,tab_id in tab_list -%}
                        <li role="presentation"
                            {% if loop.first %}class="active"{% endif %}>
                            <a class="nav-link" id="{{ tab_id }}-tab" data-toggle="tab" role="tab"
                               href="#{{ tab_id }}"
                                    {% if loop.first %}
                               aria-expanded="true"
                               aria-selected="true"
                                    {% else %}
                               aria-selected="false"
                                    {% endif %}
                               aria-controls="{{ tab_id }}">{{ tab_name }} <i class="fa fa-check-circle-o complete-mark"
                                                                              title="This tab is complete"></i></a>
                        </li>
                    {%- endfor %}

                </ul>

                <div class="tab-content" id="ctEvalTabsContent">
                    <div class="tab-pane active" id="scan" role="tabpanel" aria-labelledby="scan-tab">
                        <div class="row">
                            <div class="col-sm-4 col-md-3 col-lg-2 form-group">
                                <label for="cedos" class="control-label required">CT study date</label>
                                {{ f.datepicker("cedos", "past", "CT Study date is required") }}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-6 col-md-4 col-lg-3  form-group">
                                <label for="cerads">Signing radiologist</label>
                                <select class="form-control" id="cerads" name="cerads">
                                    <option value="-" selected>&mdash;</option>
                                    {#TODO#}
                                </select>
                            </div>
                            <div class="col-sm-6 col-md-4 col-lg-3 form-group">
                                {# TODO Get from signed on user, use text instead of input field #}
                                <label for="cerad" class="control-label required">Radiologist</label>
                                <input type="text" class="form-control" id="cerad" name="cerad" required="required"/>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 form-group">
                                <label for="ceclin" class="control-label">Clinical information</label>
                                <textarea class="form-control" id="ceclin" name="ceclin" rows="3"></textarea>
                                {{ f.inlineCheckbox("ceclini", "y", "Include in impression") }}
                            </div>
                        </div>

                        <div class="row">
                            <div class="form-group col-sm-12">
                                {{ f.checkbox("ceofr", "y", "CT scan performed at outside institution") }}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-12 form-group">
                                <label for="sbdsd-b" class="control-label required">Type of exam</label>
                                <br/>
                                <label class="radio-inline">
                                    <input type="radio" name="cetex" id="cetex-b" value="b" required="required">
                                    Baseline
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="cetex" id="cetex-a" value="a" required="required"> Annual
                                    repeat
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="cetex" id="cetex-d" value="d" required="required">
                                    Follow-up (not annual repeat)
                                </label>
                                <div class="alert alert-warning">
                                    Only select Baseline if there is no prior CT or there is a prior CT scan more than 3 years ago
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-12 form-group">
                                <label for="cectp-l" class="control-label required">CT protocol</label>
                                <br/>
                                <label class="radio-inline">
                                    <input type="radio" name="cectp" id="cectp-l" value="l" required="required">
                                    Low-Dose CT
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="cectp" id="cectp-d" value="d" required="required">
                                    Standard CT
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="cectp" id="cectp-i" value="i" required="required"> Limited
                                    CT
                                </label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-4">
                                <div class="form-group">
                                    <label for="cectrst" class="control-label required">Reconstructed slice thickness
                                        (mm)</label>
                                    <select name="cectrst" id="cectrst" class="form-control" required="required">
                                        <option value=""> -</option>
                                        <option value="0.5">0.5</option>
                                        <option value="0.625">0.625</option>
                                        <option value="0.75">0.75</option>
                                        <option value="0.8">0.8</option>
                                        <option value="1.0">1.0</option>
                                        <option value="o">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-4 form-group" id="cectrsto-container">
                                <label for="cectrsto" class="control-label required">Specify</label>
                                <input class="form-control" type="text" name="cectrsto" id="cectrsto"
                                       placeholder="specify" required="required" data-fv-numeric="true" min="0"
                                       maxlength="5">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-4 form-group">
                                <label for="sidoe" class="control-label required">Baseline
                                    CT</label>
                                {{ f.datepicker("sidoe", "past", "Baseline CT date is required") }}
                                <small class="form-text text-muted pull-right">
                                    <span id="cetsb-text">0</span> months since baseline
                                </small>
                            </div>

                            <div id="non-baseline-container">
                                <div class="col-sm-4 form-group">
                                    <label for="cedcs" class="control-label required">Most recent comparative
                                        study</label>
                                    {{ f.datepicker("cedcs", "past", "Date is required") }}
                                </div>
                                <div class="col-sm-4  form-group">
                                    <label for="cedps" class="control-label required">Prior scans</label>
                                    <input type="text" class="form-control" id="cedps" name="cedps"
                                           required="required"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    {# END Scan tab#}
                    <div class="tab-pane" id="nodules" role="tabpanel" aria-labelledby="nodules-tab">
                        <div class="row">
                            <div class="alert alert-warning">
                                <h4>READ before completing the Nodule Grid</h4>
                                <ul>
                                    <li>Include all Parenchymal and Endobronchial Nodules >= 6.0 mm in average diameter.</li>
                                    <li>For BASELINE CT, all nodules are new unless there is a CT more than 3 years earlier.</li>
                                    <li>For BASELINE CT, the nodules will automatically be sorted with the largest
                                        non-calcified nodule coming first.
                                    </li>
                                    <li>Note: hilar masses and focal consolidation should be included in the nodule
                                        grid.
                                    </li>
                                    <li>The same nodule ID will be used on all subsequent CT and other forms. NEW
                                        nodules, even if LARGER, must follow nodules already listed.
                                    </li>
                                    <li>For nodules recommended for biopsy or antibiotics, list the reason in the
                                        comments field in the corresponding column.
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div class="row">
                            <div id="add-first-nodule" class="alert alert-info">
                                If no nodules were detected, you may skip this section.
                                <button type="button" class="btn btn-default btn-xs" onclick="addNodule()">
                                    <span class="fa fa-plus" aria-hidden="true"></span> Add nodule
                                </button>
                            </div>
                            <div class="col-md-12" style="display: none;" id="nodule-table">
                                <div class="table-responsive">
                                    <button type="button" class="btn btn-default btn-sm" onclick="addNodule()">
                                        <span class="fa fa-plus" aria-hidden="true"></span> Add nodule
                                    </button>
                                    <!-- TODO: figure out what bm() function did onclick of cefctn -->
                                    <table class="table-striped" style="table-layout:auto;">
                                        <thead>
                                        <tr>
                                            <th>Nodule ID</th>
                                            {% for i in noduleArray %}
                                                <th data-nodule-id="{{ i }}" style="display:none;">
                                                    Nodule {{ i }}
                                                    <i class="remove-nodule fa fa-trash-o pull-right"
                                                       title="Remove nodule {{ i }}" data-nodule-id="{{ i }}"
                                                       onclick="removeNodule()"></i>
                                                </th>
                                            {% endfor %}
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td style="white-space: nowrap;">
                                                <label class="control-label required" for="cect1ch">
                                                    Is it new? <i class="fa fa-question-circle-o" aria-hidden="true"
                                                                  data-toggle="popover" title="Help" data-content="A pull-down menu
                                                                allows us to note whether a nodule is newly seen, previously seen,
                                                                or seen in retrospect, as well as any change in size. Change
                                                                (increase or decrease) refers to a change in the size of a nodule
                                                                or a change in the solid component of a part-solid nodule. There
                                                                is also an option for nodules that are not included in the scan."></i>
                                                </label>
                                            </td>
                                            {% for i in noduleArray %}
                                                <td data-nodule-id="{{ i }}" style="display:none;">
                                                    <div class="form-group form-group-sm">
                                                        {# TODO What does newStat({{ i }}) do onchange?#}
                                                        <select name="cect{{ i }}ch" id="cect{{ i }}ch"
                                                                title="Is this nodule new?" class="form-control"
                                                                required="required" tabindex="{{ i }}01">
                                                            <option value=""> -
                                                            <option value="n"> Newly seen</option>
                                                            <option value="pn"> Prev seen, no change</option>
                                                            <option value="pd"> Prev seen, slight decr</option>
                                                            <option value="pe"> Prev seen, marked decr</option>
                                                            <option value="pi"> Prev seen, slight incr</option>
                                                            <option value="pj"> Prev seen, marked incr</option>
                                                            <option value="po"> Prev seen, obscured</option>
                                                            <option value="pw"> Prev seen, resolved</option>
                                                            <option value="px"> Prev seen, not a nodule</option>
                                                            <option value="pr"> Prev seen, resected</option>
                                                            <option value="rn"> Retrospect, no chg</option>
                                                            <option value="rd"> Retrospect, decrease</option>
                                                            <option value="ri"> Retrospect, slight incr</option>
                                                            <option value="rj"> Retrospect, marked incr</option>
                                                            <option value="pk"> Not in outside report</option>
                                                            <option value="pv"> Not included in scan</option>
                                                        </select>
                                                    </div>
                                                </td>
                                            {% endfor %}
                                        </tr>
                                        <tr>
                                            <td style="white-space: nowrap;">
                                                <label class="control-label required" for="cect1en">
                                                    Endobronchial? <i class="fa fa-question-circle-o" aria-hidden="true"
                                                                      data-toggle="popover" title="Help"
                                                                      data-content="It is required that both Endobronchial and Most
                                                                    likely location be answered.  If the nodule has both a
                                                                    bronchial and parenchymal component, answer both to indicate
                                                                    such."></i>
                                                </label>
                                            </td>
                                            {% for i in noduleArray %}
                                                <td data-nodule-id="{{ i }}" style="display:none;">
                                                    <div class="form-group form-group-sm">
                                                        <select name="cect{{ i }}en" id="cect{{ i }}en"
                                                                title="Endobronchial" class="form-control"
                                                                required="required" tabindex="{{ i }}02">
                                                            <option value=""> -</option>
                                                            <option value="no"> No</option>
                                                            <option value="tr"> Trachea</option>
                                                            <option value="rm"> Rt. Main</option>
                                                            <option value="lm"> Lt. Main</option>
                                                            <option value="bi"> BI</option>
                                                            <option value="rul"> RUL</option>
                                                            <option value="rml"> RML</option>
                                                            <option value="rll"> RLL</option>
                                                            <option value="lul"> LUL</option>
                                                            <option value="lll"> LLL</option>
                                                        </select>
                                                    </div>
                                                </td>
                                            {% endfor %}
                                        </tr>
                                        <tr>
                                            <td style="white-space: nowrap;">
                                                <label class="control-label required" for="cect1ll">
                                                    Most likely location? <i class="fa fa-question-circle-o"
                                                                             aria-hidden="true"
                                                                             data-toggle="popover" title="Help"
                                                                             data-content="If a nodule location is different from where it was described to be previously, do not go back and change the location on the previous exams but make sure to make a note of the previously mentioned location in the Comment field (see description below)."></i>
                                                </label>
                                            </td>
                                            {% for i in noduleArray %}
                                                <td data-nodule-id="{{ i }}" style="display:none;">
                                                    <div class="form-group form-group-sm">
                                                        <select name="cect{{ i }}ll" id="cect{{ i }}ll"
                                                                title="Most likely location" class="form-control"
                                                                required="required" tabindex="{{ i }}03">
                                                            <option value=""> -</option>
                                                            <option value="end"> Endobr</option>
                                                            <option value="lul"> LUL</option>
                                                            <option value="lll"> LLL</option>
                                                            <option value="rul"> RUL</option>
                                                            <option value="rml"> RML</option>
                                                            <option value="rll"> RLL</option>
                                                        </select>
                                                    </div>
                                                </td>
                                            {% endfor %}
                                        </tr>
                                        <tr>
                                            <td style="white-space: nowrap;">
                                                <label class="control-label required" for="cect1sn"> Nodule seen in
                                                    series </label>
                                                <i class="fa fa-question-circle-o" aria-hidden="true"
                                                   data-toggle="popover" title="Help"
                                                   data-content="Indicate the CT series number in which the nodule appears."></i>
                                            </td>
                                            {% for i in noduleArray %}
                                                <td data-nodule-id="{{ i }}" style="display:none;" class="form-inline">
                                                    <div class="form-group form-group-sm">
                                                        <input type="text" name="cect{{ i }}sn" id="cect{{ i }}sn"
                                                               size="3" class="form-control"
                                                               title="CT Series Number" required="required" tabindex="{{ i }}04">
                                                    </div>
                                                </td>
                                            {% endfor %}
                                        </tr>
                                        <tr>
                                            <td style="white-space: nowrap;">
                                                <label class="control-label required" for="cect1inl">Nodule seen in
                                                    images</label>
                                                <i class="fa fa-question-circle-o" aria-hidden="true"
                                                   data-toggle="popover" title="Help"
                                                   data-content="Indicate the CT image number in which the nodule appears."></i>
                                            </td>
                                            {% for i in noduleArray %}
                                                <td data-nodule-id="{{ i }}" style="display:none;" class="form-inline">
                                                    <div class="form-group form-group-sm">
                                                        <input type="text" name="cect{{ i }}inl" id="cect{{ i }}inl"
                                                               size="3" class="form-control"
                                                               title="CT Image Number" required="required" tabindex="{{ i }}05">
                                                    </div>
                                                </td>
                                            {% endfor %}
                                        </tr>
                                        <tr>
                                            <td style="white-space: nowrap;">
                                                <label class="control-label required" for="cect1st">Nodule
                                                    status</label>
                                                <i class="fa fa-question-circle-o"
                                                   aria-hidden="true"
                                                   data-toggle="popover" title="Help"
                                                   data-content="If nodule calcifications are seen ('yes' is selected for Calcifications), 'benign (Ca++)' will automatically appear under Nodule Status.<li> When '?' is selected under Calcifications, Nodule Status will read 'prob benign, prob Ca++' (probably benign, probably calcified).  If the nodule is 'prev seen, resolved,' as noted in the 'Is it new' field, then Nodule Status will automatically read 'resolved.'  When 'prev seen, resected' is selected for 'Is it new', 'Resected-malignant' appears under Nodule Status.  If under 'Is it new' it reads 'not included in scan,' Nodule Status will also read 'not included in scan.'  These automatic entries help to maintain a level of consistency for data entry across institutions."></i>
                                            </td>
                                            {% for i in noduleArray %}
                                                <td data-nodule-id="{{ i }}" style="display:none;">
                                                    <div class="form-group form-group-sm">
                                                        <select name="cect{{ i }}st" id="cect{{ i }}st"
                                                                title="Nodule status" class="form-control"
                                                                required="required" tabindex="{{ i }}06">
                                                            <option value="-"> -</option>
                                                            <option value="un"> Unknown</option>
                                                            <option value="bc"> Benign (Ca++)</option>
                                                            <option value="pc"> Prob benign, prob Ca++</option>
                                                            <option value="re"> Resolved</option>
                                                            <option value="rg"> Resolving</option>
                                                            <option value="tn"> No change - 2 yrs</option>
                                                            <option value="pp"> PET - positive</option>
                                                            <option value="pn"> PET - negative</option>
                                                            <option value="pi"> PET - indeterminate</option>
                                                            <option value="ub"> Biopsy - unknown</option>
                                                            <option value="bb"> Biopsy - benign</option>
                                                            <option value="mb"> Biopsy - malignant</option>
                                                            <option value="ab"> Biopsy - atyp bronch prolif</option>
                                                            <option value="om"> Biopsy - metastatic</option>
                                                            <option value="mr"> Resected - malignant</option>
                                                            <option value="br"> Resected - benign</option>
                                                        </select>
                                                    </div>
                                                </td>
                                            {% endfor %}
                                        </tr>
                                        <tr>
                                            <td style="white-space: nowrap;">
                                                <label class="control-label required" for="cect1nt">Nodule
                                                    consistency</label>
                                                <i class="fa fa-question-circle-o" aria-hidden="true"
                                                   data-toggle="popover" title="Help"
                                                   data-content="Nodules may be classified into three types by attenuation characteristics: solid - nodule is uniformly solid in appearance; nonsolid - nodule is uniformly nonsolid (except for blood vessels) in appearance; part-solid - nodule has both solid and nonsolid components"></i>
                                            </td>
                                            {% for i in noduleArray %}
                                                <td data-nodule-id="{{ i }}" style="display:none;">
                                                    <div class="form-group form-group-sm">
                                                        <select name="cect{{ i }}nt" id="cect{{ i }}nt"
                                                                class="form-control" title="Nodule Consistency"
                                                                required="required" tabindex="{{ i }}07">
                                                            <option value="-"> -</option>
                                                            <option value="s"> Solid</option>
                                                            <option value="m"> Part-solid</option>
                                                            <option value="g"> Nonsolid</option>
                                                            <option value="o"> Other (see comment)</option>
                                                        </select>
                                                    </div>
                                                </td>
                                            {% endfor %}
                                        </tr>
                                        <tr>
                                            <td style="white-space: nowrap;">
                                                <label class="control-label required" for="cect1sl">Length (mm)</label>
                                                <i class="fa fa-question-circle-o" aria-hidden="true"
                                                   data-toggle="popover" title="Help"
                                                   data-content="Indicate the length (largest dimension) of the nodule.  The unit of measurement is always millimeters."></i>
                                            </td>
                                            {% for i in noduleArray %}
                                                <td data-nodule-id="{{ i }}" style="display:none;" class="form-inline">
                                                    <div class="form-group form-group-sm">
                                                        <input type="text" name="cect{{ i }}sl" id="cect{{ i }}sl"
                                                               size="4" title="Length (mm)" class="form-control numeric"
                                                               required="required" tabindex="{{ i }}08">
                                                    </div>
                                                </td>
                                            {% endfor %}
                                        </tr>
                                        <tr>
                                            <td style="white-space: nowrap;">
                                                <label class="control-label required" for="cect1sw">Maximum width
                                                    (mm)</label>
                                                <i class="fa fa-question-circle-o" aria-hidden="true"
                                                   data-toggle="popover" title="Help"
                                                   data-content="Indicate the maximum width (largest perpendicular dimension to the length) of the nodule.  The unit of measurement is always millimeters."></i>
                                            </td>
                                            {% for i in noduleArray %}
                                                <td data-nodule-id="{{ i }}" style="display:none;" class="form-inline">
                                                    <div class="form-group form-group-sm">
                                                        <input type="text" name="cect{{ i }}sw" id="cect{{ i }}sw"
                                                               size="4" title="Maximum Width"
                                                               class="form-control numeric"
                                                               required="required" tabindex="{{ i }}09">
                                                    </div>
                                                </td>
                                            {% endfor %}
                                        </tr>
                                        <tr>
                                            <td style="white-space: nowrap;">
                                                <label class="control-label" for="cect1sd">Mean diameter(mm)</label>
                                                <i class="fa fa-question-circle-o" aria-hidden="true"
                                                   data-toggle="popover" title="Help"
                                                   data-content="Calculated mean diameter."></i>
                                            </td>
                                            {% for i in noduleArray %}
                                                <td data-nodule-id="{{ i }}" style="display:none;" class="form-inline">
                                                    <div class="form-group form-group-sm">
                                                        
                                                        <label id="cect{{ i }}sd-val"
                                                               title="Mean diameter"
                                                               class="numeric">-</label>
                                                    </div>
                                                </td>
                                            {% endfor %}
                                        </tr>
                                        <tr>
                                            <td style="white-space: nowrap;">
                                                <label class="control-label" for="cect1sh">Height (mm)</label>
                                            </td>
                                            {% for i in noduleArray %}
                                                <td data-nodule-id="{{ i }}" style="display:none;" class="form-inline">
                                                    <div class="form-group form-group-sm">
                                                        <input type="text" name="cect{{ i }}sh" id="cect{{ i }}sh"
                                                               size="4" title="Height" class="form-control numeric" tabindex="{{ i }}10">
                                                    </div>
                                                </td>
                                            {% endfor %}
                                        </tr>
                                        <tr>
                                            <td style="white-space: nowrap;">
                                                <label class="control-label" for="cect1sv">Volume
                                                    (mm<sup>3</sup>)</label>
                                            </td>
                                            {% for i in noduleArray %}
                                                <td data-nodule-id="{{ i }}" style="display:none;" class="form-inline">
                                                    <div class="form-group form-group-sm">
                                                        <input type="text" name="cect{{ i }}sv" id="cect{{ i }}sv"
                                                               size="4" title="Volume" class="form-control numeric" tabindex="{{ i }}11">
                                                    </div>
                                                </td>
                                            {% endfor %}
                                        </tr>
                                        <tr>
                                            <td style="white-space: nowrap;">
                                                <label class="control-label required" for="cect1ssl">Solid comp. of
                                                    part-solid</label>
                                            </td>
                                            {% for i in noduleArray %}
                                                <td data-nodule-id="{{ i }}" style="display:none;" class="form-inline">
                                                    <div id="cect{{ i }}-container">
                                                        <div class="form-group form-group-sm">
                                                            <input type="text" name="cect{{ i }}ssl" id="cect{{ i }}ssl"
                                                                   size="4" title="Solid Comp. Length"
                                                                   placeholder="length"
                                                                   class="form-control numeric" required="required" tabindex="{{ i }}12">
                                                        </div>
                                                        &nbsp; x &nbsp;
                                                        <div class="form-group form-group-sm">
                                                            <input type="text" name="cect{{ i }}ssw" id="cect{{ i }}ssw"
                                                                   size="4" title="Solid Comp. Width"
                                                                   placeholder="width"
                                                                   class="form-control numeric" required="required" tabindex="{{ i }}13">
                                                        </div>
                                                    </div>
                                                </td>
                                            {% endfor %}
                                        </tr>
                                        <tr>
                                            <td style="white-space: nowrap;">
                                                <label class="control-label" for="cect1se-n">Smooth edges</label> <i
                                                    class="fa fa-question-circle-o" aria-hidden="true"
                                                    data-toggle="popover" title="Help"
                                                    data-content="Indicate whether the nodule has a smooth-appearing margin."></i>
                                            </td>
                                            {% for i in noduleArray %}
                                                <td data-nodule-id="{{ i }}" style="display:none;">
                                                    <div class="form-group form-group-sm">
                                                        {{ f.inlineRadioNYQ("cect" + i|string + "se", false, i|string + "14") }}
                                                    </div>
                                                </td>
                                            {% endfor %}
                                        </tr>
                                        <tr>
                                            <td style="white-space: nowrap;">
                                                <label class="control-label" for="cect1sp-n">Spiculated</label>
                                            </td>
                                            {% for i in noduleArray %}
                                                <td data-nodule-id="{{ i }}" style="display:none;">
                                                    <div class="form-group form-group-sm">
                                                        {{ f.inlineRadioNYQ("cect" + i|string + "sp", false, i|string + "15") }}
                                                    </div>
                                                </td>
                                            {% endfor %}
                                        </tr>
                                        <tr>
                                            <td style="white-space: nowrap;">
                                                <label class="control-label" for="cect1pld">
                                                    Distance from the costal pleura (mm)?</label>
                                                <i class="fa fa-question-circle-o" aria-hidden="true"
                                                   data-toggle="popover" title="Help"
                                                   data-content="The shortest distance from the nodule to the costal pleura should be measured in millimeters."></i>
                                            </td>
                                            {% for i in noduleArray %}
                                                <td data-nodule-id="{{ i }}" style="display:none;" class="form-inline">
                                                    <div class="form-group form-group-sm">
                                                        <input type="text" name="cect{{ i }}pld" id="cect{{ i }}pld"
                                                               class="numeric"
                                                               title="Distance" tabindex="{{ i }}16">
                                                    </div>
                                                </td>
                                            {% endfor %}
                                        </tr>
                                        <tr>
                                            <td style="white-space: nowrap;">
                                                <label class="control-label" for="cect1ac">Action</label> <i
                                                    class="fa fa-question-circle-o"
                                                    aria-hidden="true"
                                                    data-toggle="popover" title="Help"
                                                    data-content="This field becomes very important when different nodules require different follow-up.  A pull-down menu allows us to choose among six different follow-up actions -    'repeat SCT' (repeat screening CT),    'follow-up\ Dx CT' (follow-up Diagnostic CT),    'Abx + follow-up Dx CT' (Antibiotic + follow-up Diagnostic CT),    'biopsy',    'bronchoscopy',       or    'resection'."></i>
                                            </td>
                                            {% for i in noduleArray %}
                                                <td data-nodule-id="{{ i }}" style="display:none;">
                                                    <div class="form-group form-group-sm">
                                                        <select name="cect{{ i }}ac" id="cect{{ i }}ac" title="Action"
                                                                class="form-control" tabindex="{{ i }}17">
                                                            <option value="-"> -</option>
                                                            <option value="s"> Annual repeat CT</option>
                                                            <option value="f"> Follow-up CT</option>
                                                            <option value="a"> Abx + follow-up CT</option>
                                                            <option value="e"> PET</option>
                                                            <option value="c"> CT w contrast</option>
                                                            <option value="b"> CT-guided biopsy</option>
                                                            <option value="p"> Bronchoscopy</option>
                                                            <option value="r"> Resection</option>
                                                        </select>
                                                    </div>
                                                </td>
                                            {% endfor %}
                                        </tr>
                                        <tr>
                                            <td style="white-space: nowrap;">
                                                <label class="control-label" for="cect1co">Comment</label> <i
                                                    class="fa fa-question-circle-o"
                                                    aria-hidden="true"
                                                    data-toggle="popover" title="Help"
                                                    data-content="This field is for additional comments about the nodule.  If a previously seen nodule is found to be something other than a nodule, note it here."></i>
                                            </td>
                                            {% for i in noduleArray %}
                                                <td data-nodule-id="{{ i }}" style="display:none;">
                                                    <div class="form-group form-group-sm">
                                                        <input type="text" name="cect{{ i }}co" id="cect{{ i }}co"
                                                               size="20" class="form-control" title="Comment" tabindex="{{ i }}18">
                                                    </div>
                                                </td>
                                            {% endfor %}
                                        </tr>
                                        <tr>
                                            <td style="white-space: nowrap;">
                                                <label class="control-label" for="cect1pd">Pathologic
                                                    diagnosis</label>
                                                <i class="fa fa-question-circle-o" aria-hidden="true"
                                                   data-toggle="popover" title="Help"
                                                   data-content="If a biopsy was previously performed, the diagnosis was chosen from a pull-down menu on the Biopsy form.  When CT evaluation forms are created after the biopsy was done, the 'Pathologic Diagnosis' selected on the Biopsy Form is transferred onto the new CT evaluation Form.  Once a diagnosis has been assigned on the Biopsy Form and it pops up on the CT evaluation form, it CANNOT be changed."></i>
                                            </td>
                                            {% for i in noduleArray %}
                                                <td data-nodule-id="{{ i }}" style="display:none;">
                                                    <div class="form-group form-group-sm">
                                                        <select name="cect{{ i }}pd" id="cect{{ i }}pd"
                                                                title="Pathologic Diagnosis" class="form-control" tabindex="{{ i }}19">
                                                            <option value="-"> -For Pathology Use Only-</option>
                                                            <option value="aa"> AAH</option>
                                                            <option value="ap"> atyp bronch prolif</option>
                                                            <option value="ba"> BAC</option>
                                                            <option value="ns"> Unspec. non-small cell</option>
                                                            <option value="ad"> Adenocarcinoma</option>
                                                            <option value="as"> Adenosquamous</option>
                                                            <option value="la"> Large cell</option>
                                                            <option value="sq"> Squamous cell</option>
                                                            <option value="sm"> Small cell</option>
                                                            <option value="ct"> Carcinoid - typical</option>
                                                            <option value="ca"> Carcinoid - atypical</option>
                                                            <option value="be"> Not malignant</option>
                                                            <option value="bs"> Benign specific</option>
                                                            <option value="os"> Other (specify)</option>
                                                        </select>
                                                    </div>
                                                </td>
                                            {% endfor %}
                                        </tr>

                                        </tbody>
                                    </table>
                                    <button type="button" class="btn btn-default btn-sm" onclick="addNodule()" tabindex="1101">
                                        <span class="fa fa-plus" aria-hidden="true"></span> Add nodule
                                    </button>
                                    {{ f.checkbox("cectnum","y", "Numerous additional <= 3mm nodules (calcified or non-calcified)", {"tabindex":"1102"}) }}
                                </div>
                            </div>
                        </div>

                    </div>
                    {# END Nodules tab#}
                    <div class="tab-pane" id="abnormalities" role="tabpanel" aria-labelledby="abnormalities-tab">
                       

                        {# PULMONARY ABNORMALITIES #}
                        <div class="row">
                            <div class="form-group">
                                <div class="col-sm-4 col-md-3">
                                    <label>Pulmonary abnormalities</label>
                                </div>
                                <div class="col-sm-8 col-md-9">
                                    {{ f.inlineRadioNY("pa") }}
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive" id="pulmonary-container" style="margin-left:1em;">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th></th>
                                    <th></th>
                                    <th>RUL</th>
                                    <th>RML</th>
                                    <th>RLL</th>
                                    <th>LUL</th>
                                    <th>LLL</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% set rf = ["rul","rml","rll","lul","lll"] %}
                                <tr>
                                    <td><label class="control-label" for="cecbc-n">Cysts</label></td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("cecbc") }}
                                        </div>
                                    </td>
                                    {% for i in [1,2,3,4,5] %}
                                        <td style="padding-top:0;">
                                            <div class="form-group">
                                                {{ f.checkbox("cecbcl"+i|string, rf[i-1], "") }}
                                            </div>
                                        </td>
                                    {% endfor %}
                                </tr>
                                <tr>
                                    <td><label class="control-label" for="cecbb-n">Blebs/Bullae</label></td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("cecbb") }}
                                        </div>
                                    </td>
                                    {% for i in [1,2,3,4,5] %}
                                        <td style="padding-top:0;">
                                            <div class="form-group">
                                                {{ f.checkbox("cecbbl"+i|string, rf[i-1], "") }}
                                            </div>
                                        </td>
                                    {% endfor %}
                                </tr>
                                <tr>
                                    <td><label class="control-label" for="cerdc-n">Regional or diffuse
                                        consolidation</label><br/>
                                        <small>(focal - put in nodule grid)</small>
                                    </td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("cerdc") }}
                                        </div>
                                    </td>
                                    {% for i in [1,2,3,4,5] %}
                                        <td style="padding-top:0;">
                                            <div class="form-group">
                                                {{ f.checkbox("cerdcl"+i|string, rf[i-1], "") }}
                                            </div>
                                        </td>
                                    {% endfor %}
                                </tr>
                                <tr>
                                    <td><label class="control-label" for="cescr-n">Scarring</label></td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("cescr") }}
                                        </div>
                                    </td>
                                    {% for i in [1,2,3,4,5] %}
                                        <td style="padding-top:0;">
                                            <div class="form-group">
                                                {{ f.checkbox("cescrl"+i|string, rf[i-1], "") }}
                                            </div>
                                        </td>
                                    {% endfor %}
                                </tr>
                                <tr>
                                    <td style="border-top:none;"></td>
                                    <td colspan="6" style="border-top:none;">
                                        <div class="form-group form-inline">
                                            <label>Apical</label>&nbsp;
                                            {{ f.checkbox("cescrl6","au","Unilateral") }}
                                            {{ f.checkbox("cescrl7","ab","Bilateral") }}
                                        </div>
                                    </td>
                                </tr>

                                <tr>
                                    <td><label class="control-label" for="cebrsb-n">Bronchiectasis</label></td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("cebrsb") }}
                                        </div>
                                    </td>
                                    {% for i in [1,2,3,4,5] %}
                                        <td style="padding-top:0;">
                                            <div class="form-group">
                                                {{ f.checkbox("cebrsbl"+i|string, rf[i-1], "") }}
                                            </div>
                                        </td>
                                    {% endfor %}
                                </tr>

                                <tr>
                                    <td><label class="control-label" for="cebrss-n">Small airways disease</label></td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("cebrss") }}
                                        </div>
                                    </td>
                                    {% for i in [1,2,3,4,5] %}
                                        <td style="padding-top:0;">
                                            <div class="form-group">
                                                {{ f.checkbox("cebrssl"+i|string, rf[i-1], "") }}
                                            </div>
                                        </td>
                                    {% endfor %}
                                </tr>
                                <tr>
                                    <td><label class="control-label" for="cebs-n">Post-surgical findings</label><br/>
                                        <small>(i.e. bronchial resection margin)</small>
                                    </td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadio("cebs", "cebs-n","n","N/A") }}
                                            {{ f.inlineRadio("cebs", "cebs-o","o","Normal") }}
                                            {{ f.inlineRadio("cebs", "cebs-y","y","Abnormal") }}
                                            {{ f.inlineRadio("cebs", "cebs-e","e","Not visible") }}
                                        </div>
                                    </td>
                                    <td colspan="5">
                                        <div class="form-group form-inline">
                                            {{ f.checkbox("cebsrt", "r", "Right") }}
                                            &nbsp;
                                            {{ f.checkbox("cebslt", "l", "Left") }}
                                        </div>
                                    </td>

                                </tr>
                                </tbody>
                            </table>
                            <h4>Early and Late Findings of Interstitial Lung Disease</h4>
                            <table class="table">
                                <tbody>
                                <tr>
                                    <td><label class="control-label" for="cerb-n">Traction bronchiectasis in a
                                        peripheral location</label></td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("cerb") }}
                                        </div>
                                    </td>
                                    {% for i in [1,2,3,4,5] %}
                                        <td style="padding-top:0;">
                                            <div class="form-group">
                                                {{ f.checkbox("cerbl"+i|string, rf[i-1], "") }}
                                            </div>
                                        </td>
                                    {% endfor %}
                                </tr>

                                <tr>
                                    <td><label class="control-label" for="cepgo-n">Peripheral ground-glass
                                        opacities</label></td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("cepgo") }}
                                        </div>
                                    </td>
                                    {% for i in [1,2,3,4,5] %}
                                        <td style="padding-top:0;">
                                            <div class="form-group">
                                                {{ f.checkbox("cepgol"+i|string, rf[i-1], "") }}
                                            </div>
                                        </td>
                                    {% endfor %}
                                </tr>

                                <tr>
                                    <td><label class="control-label" for="ceret-n">Reticulations</label></td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("ceret") }}
                                        </div>
                                    </td>
                                    {% for i in [1,2,3,4,5] %}
                                        <td style="padding-top:0;">
                                            <div class="form-group">
                                                {{ f.checkbox("ceretl"+i|string, rf[i-1], "") }}
                                            </div>
                                        </td>
                                    {% endfor %}
                                </tr>

                                <tr>
                                    <td><label class="control-label" for="cephc-n">Honeycombing</label></td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("cephc") }}
                                        </div>
                                    </td>
                                    {% for i in [1,2,3,4,5] %}
                                        <td style="padding-top:0;">
                                            <div class="form-group">
                                                {{ f.checkbox("cephcl"+i|string, rf[i-1], "") }}
                                            </div>
                                        </td>
                                    {% endfor %}
                                </tr>

                                <tr>
                                    <td colspan="7">
                                        <div class="form-group">
                                            <label for="ceoppa">Additional comments on pulmonary abnormalities</label>
                                            <textarea name="ceoppa" id="ceoppa" class="form-control"></textarea>
                                            {{ f.inlineCheckbox("ceoppai", "y", "Include in impression") }}
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <h4>Pleural or pleural-related Abnormalities</h4>
                            <table class="table">
                                <tbody>
                                <tr>
                                    <td><label class="control-label" for="cept-n">Pleural thickening/plaques</label>
                                    </td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("cept") }}
                                        </div>
                                    </td>
                                    <td colspan="5">
                                        <div class="form-group form-inline">
                                            {{ f.checkbox("ceptrt", "r", "Right") }}
                                            &nbsp;
                                            {{ f.checkbox("ceptlt", "l", "Left") }}
                                            &nbsp;
                                            {{ f.checkbox("ceptct", "c", "Calcification") }}
                                        </div>
                                    </td>
                                </tr>

                                <tr>
                                    <td><label class="control-label" for="cebatr-n">Rounded atelectasis</label></td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("cebatr") }}
                                        </div>
                                    </td>
                                    {% for i in [1,2,3,4,5] %}
                                        <td style="padding-top:0;">
                                            <div class="form-group">
                                                {{ f.checkbox("cebatrl"+i|string, rf[i-1], "") }}
                                            </div>
                                        </td>
                                    {% endfor %}
                                </tr>

                                <tr>
                                    <td><label class="control-label" for="cepev">Pleural effusion</label></td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.checkbox("cepev","e", "Not visible") }}
                                        </div>
                                    </td>
                                    <td colspan="5">
                                        <div class="form-group pull-left">
                                            <label for="ceper">Right</label>
                                            <select id="ceper" name="ceper" class="form-control" required="required">
                                                <option value="-"> -</option>
                                                <option value="no"> None</option>
                                                <option value="sm"> Small</option>
                                                <option value="mo"> Moderate</option>
                                                <option value="lg"> Large</option>
                                            </select>
                                        </div>

                                        <div class="form-group pull-left">
                                            <label for="cepel">Left</label>
                                            <select id="cepel" name="cepel" class="form-control" required="required">
                                                <option value="-"> -</option>
                                                <option value="no"> None</option>
                                                <option value="sm"> Small</option>
                                                <option value="mo"> Moderate</option>
                                                <option value="lg"> Large</option>
                                            </select>
                                        </div>
                                    </td>
                                </tr>

                                <tr>
                                    <td><label class="control-label" for="cepu-n">Pleural tumor</label></td>
                                    <td colspan="6">
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("cepu") }}
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="7">
                                        <div class="form-group">
                                            <label for="ceoppab">Describe pleural abnormalities</label>
                                            <textarea name="ceoppab" id="ceoppab" class="form-control"></textarea>
                                            {{ f.inlineCheckbox("ceoppabi", "y", "Include in impression") }}
                                        </div>
                                    </td>
                                </tr>

                                </tbody>
                            </table>
                            <hr/>
                        </div>

                        {# CARDIAC ABNORMALITIES #}
                        <div class="row">
                            <div class="form-group">
                                <div class="col-sm-4 col-md-3">
                                    <label>Other Cardio-vascular Abnormalities</label>
                                </div>
                                <div class="col-sm-8 col-md-9">
                                    {{ f.inlineRadioNYE("ceca") }}
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive" id="cardiac-container" style="margin-left:1em;">
                            <table class="table">
                                <tbody>
                                <tr>
                                    <td><label class="control-label" for="cecca">Aortic calcification</label></td>
                                    <td>
                                        <div class="form-group">{{ f.checkbox("ceccav","e","Not visible") }}</div>
                                    </td>
                                    <td colspan="5">
                                        <div class="form-group">
                                            <select name="cecca" class="form-control" title="Aortic Calcification">
                                                <option value="-"> -</option>
                                                <option value="no"> None</option>
                                                <option value="mi"> Minimal < &frac13;</option>
                                                <option value="mo"> Moderate</option>
                                                <option value="ex"> Extensive > &frac23;</option>
                                            </select>
                                        </div>
                                    </td>
                                </tr>

                                <tr>
                                    <td><label class="control-label" for="ceprevm">Pericardial effusion severity</label>
                                    </td>
                                    <td>
                                        <div class="form-group">{{ f.checkbox("ceprev","e","Not visible") }}</div>
                                    </td>
                                    <td colspan="5">
                                        <div class="form-group">
                                            <select name="ceprevm" id="ceprevm" class="form-control"
                                                    title="Pericardial Effusion Severity">
                                                <option value="-"> -</option>
                                                <option value="no"> None</option>
                                                <option value="mi"> Minimal</option>
                                                <option value="mo"> Moderate</option>
                                                <option value="ex"> Extensive</option>
                                            </select>
                                        </div>

                                <tr>
                                    <td colspan="2"><label class="control-label" for="cepaw">Pulmonary artery width
                                        (mm)</label></td>
                                    <td>
                                        <div class="form-group">
                                            <input type="text" id="cepaw" name="cepaw" size="4"
                                                   class="form-control numeric" data-fv-integer="true"
                                                   title="Pulmonary Artery Width">
                                        </div>
                                    </td>
                                    <td colspan="4">&nbsp;</td>
                                </tr>

                                <tr>
                                    <td colspan="2"><label class="control-label" for="ceaow">Ascending aorta width
                                        (mm)</label></td>
                                    <td>
                                        <div class="form-group">
                                            <input type="text" id="ceaow" name="ceaow" size="4"
                                                   class="form-control numeric" data-fv-integer="true"
                                                   title="Ascending Aorta Width">
                                        </div>
                                    </td>
                                    <td colspan="4">
                                        &nbsp;
                                    </td>
                                </tr>

                                <tr>
                                    <td colspan="2"><label class="control-label" for="cepar">Pulmonary artery/aorta
                                        ratio</label><br/>
                                        <small>(calculated)</small>
                                    </td>
                                    <td colspan="5">
                                        <div class="form-group">
                                            <span id="cepar-text"></span>
                                            <input type="hidden" id="cepar" name="cepar">
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="7">
                                        <div class="form-group">
                                            <label for="cecommca">Additional comments on cardiac abnormalities</label>
                                            <textarea name="cecommca" id="cecommca" class="form-control"></textarea>
                                            {{ f.inlineCheckbox("cecommcai", "y", "Include in impression") }}
                                        </div>
                                    </td>
                                </tr>

                                </tbody>
                            </table>
                            <hr/>
                        </div>

                        {# Neck and Mediastinal Abnormalities #}
                        <div class="row">
                            <div class="form-group">
                                <div class="col-sm-4 col-md-3">
                                    <label for="ceoma-n">Neck and mediastinal abnormalities</label>
                                </div>
                                <div class="col-sm-8 col-md-9">
                                    {{ f.inlineRadioNYE("ceoma") }}
                                </div>
                            </div>
                        </div>

                        <div class="table-responsive" id="neck-container" style="margin-left:1em;">
                            <table class="table">
                                <tbody>
                                <tr>
                                    <td><label class="control-label" for="ceata-n">Thyroid</label></td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("ceata") }}
                                        </div>
                                    </td>
                                    <td style="padding-top:0;">
                                        <div class="form-group form-inline">
                                            {{ f.checkbox("ceatc","c","Calcification") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceaty","y","Cyst") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceatm","m","Mass") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceato","o","Other") }}&nbsp;&nbsp;
                                            <input type="text" name="ceatos" id="ceatos" class="form-control"
                                                   required="required"
                                                   placeholder="Specify">
                                        </div>
                                    </td>
                                </tr>

                                <tr>
                                    <td><label class="control-label" for="ceaya-n">Thymus</label><br/>
                                        <small>(report if ovoid &gt; 7 mm or if thymic shape with width &gt; 1.3cm)
                                        </small>
                                    </td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("ceaya") }}
                                        </div>
                                    </td>
                                    <td style="padding-top:0;">
                                        <div class="form-group form-inline">
                                            {{ f.checkbox("ceayc","c","Calcification") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceayy","y","Cyst") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceaym","m","Mass") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceayo","o","Other") }}&nbsp;&nbsp;
                                            <input type="text" name="ceayos" id="ceayos" class="form-control"
                                                   required="required"
                                                   placeholder="Specify">
                                        </div>
                                    </td>
                                </tr>

                                <tr>
                                    <td colspan="3">
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <h4>Lymph Nodes
                                <small>(w/o central fat)</small>
                            </h4>

                            <table class="table">
                                <tbody>

                                <tr>
                                    <td>
                                        Any enlarged or growing hilar or mediastinal lymph nodes<br/>
                                        <small>(short axis &gt; 10mm)<br/>
                                            <strong>(any size for para-esophageal)</strong></small>
                                    </td>
                                    <td>
                                        <div class="form-group form-inline">
                                            {{ f.inlineRadioNYE("cemln") }}
                                        </div>
                                    </td>
                                    <td>
                                        <div class="form-group">
                                            <label for="validator-cemln">Level</label>
                                            <input type="hidden" id="validator-cemln" name="validator-cemln" value="0"/>
                                            {{ f.checkbox("cemlnl1","N1","N1 (high mediastinal)") }}
                                            {{ f.checkbox("cemlnl2r","N2R","N2R") }}
                                            {{ f.checkbox("cemlnl2l","N2L","N2L (upper paratracheal)") }}
                                            {{ f.checkbox("cemlnl3","N3","N3 (prevascular,retrotracheal)") }}
                                            {{ f.checkbox("cemlnl4r","N4R","N4R") }}
                                            {{ f.checkbox("cemlnl4l","N4L","N4L (lower paratracheal)") }}
                                            {{ f.checkbox("cemlnl5","N5","N5 (subaortic (A-P window))") }}
                                            {{ f.checkbox("cemlnl6","N6","N6 (para-aortic)") }}
                                            {{ f.checkbox("cemlnl7","N7","N7 (subcarinal)") }}
                                            {{ f.checkbox("cemlnl8","N8","N8 (para-esophageal), any size") }}
                                            {{ f.checkbox("cemlnl9","N9","N9 (pulmonary ligament)") }}
                                            {{ f.checkbox("cemlnl10r","N10R","N10R") }}
                                            {{ f.checkbox("cemlnl10l","N10L","N10L (hilar)") }}
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Any calcified hilar or mediastinal lymph nodes</td>
                                    <td colspan="2">
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("cemlncab") }}
                                        </div>
                                    </td>
                                </tr>

                                <tr>
                                    <td>Axillary lymph nodes</td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("ceagaln") }}
                                        </div>
                                    </td>
                                    <td style="padding-top:1px;">
                                        <div class="form-group form-inline">
                                            {{ f.checkbox("ceagalnrt","r","Right") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceagalnlt","l","Left") }}&nbsp;&nbsp;
                                            <input type="text" name="ceagalns" id="ceagalns" class="form-control"
                                                   required="required" placeholder="Specify">
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Other Vascular Abnormalities</td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("cemva") }}
                                        </div>
                                    </td>
                                    <td style="padding-top:1px;">
                                        <div class="form-group form-inline">
                                            {{ f.checkbox("cemvaa","a","Aorta") }}&nbsp;&nbsp;
                                            {{ f.checkbox("cemvap","w","Pulmonary arteries") }}&nbsp;&nbsp;
                                            {{ f.checkbox("cemvao","o","Other") }}&nbsp;&nbsp;
                                            <input type="text" name="cemvaos" id="cemvaos" class="form-control"
                                                   required="required" placeholder="Specify">
                                        </div>
                                    </td>
                                </tr>

                                <tr>
                                    <td>Esophageal</td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("cemeln") }}
                                        </div>
                                    </td>
                                    <td style="padding-top:1px;">
                                        <div class="form-group form-inline">
                                            {{ f.checkbox("cemelna","a","Air-fluid level") }}&nbsp;&nbsp;
                                            {{ f.checkbox("cemelnw","w","Wall thickening") }}&nbsp;&nbsp;
                                            {{ f.checkbox("cemelnm","m","Mass") }}&nbsp;&nbsp;
                                            {{ f.checkbox("cemvlno","o","Other") }}&nbsp;&nbsp;
                                            <input type="text" name="cemelnos" id="cemelnos" class="form-control"
                                                   required="required" placeholder="Specify">
                                        </div>
                                    </td>
                                </tr>

                                <tr>
                                    <td>Hiatal Hernia</td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("cehhn") }}
                                        </div>
                                    </td>
                                    <td style="padding-top:1px;">
                                        <div class="form-group form-inline">
                                            <input type="text" name="cehhnos" id="cehhnos" class="form-control"
                                                   required="required" placeholder="Specify">
                                        </div>
                                    </td>
                                </tr>


                                <tr>
                                    <td>Other Mediastinal Masses</td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("ceomm") }}
                                        </div>
                                    </td>
                                    <td style="padding-top:1px;">
                                        <div class="form-group form-inline">
                                            {{ f.checkbox("ceamc","v","Calcification") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceamy","y","Cyst") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceamm","m","Mass") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceamo","o","Other") }}&nbsp;&nbsp;
                                            <input type="text" name="ceommos" id="ceommos" class="form-control"
                                                   required="required" placeholder="Specify">
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <div class="form-group">
                                            <label for="ceotabnm">Additional comments on neck and mediastinal
                                                abnormalities</label>
                                            <textarea name="ceotabnm" id="ceotabnm" class="form-control"></textarea>
                                            {{ f.inlineCheckbox("ceotabnmi", "y", "Include in impression") }}
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <hr/>
                        </div>

                        {# Breast Abnormalities #}
                        <div class="row">
                            <div class="form-group">
                                <div class="col-sm-4 col-md-3">
                                    <label for="ceoba-n">Breast abnormalities</label>
                                </div>
                                <div class="col-sm-8 col-md-9">
                                    {{ f.inlineRadioNYE("ceoba") }}
                                </div>
                            </div>
                        </div>

                        <div class="table-responsive" id="breast-container" style="margin-left:1em;">
                            <table class="table">
                                <tbody>
                                <tr>
                                    <td>Right Breast</td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("ceara") }}
                                        </div>
                                    </td>
                                    <td style="padding-top:1px;">
                                        <div class="form-group form-inline">
                                            {{ f.checkbox("ceobarc","c","Calcification") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceobary","y","Cyst") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceobarm","m","Mass") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceobaro","o","Other") }}&nbsp;&nbsp;
                                            <input type="text" name="ceobaros" id="ceobaros" class="form-control"
                                                   required="required"
                                                   placeholder="Specify">
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">Right Breast Density Classification (BI-RADS)</td>
                                    <td>
                                        <div class="form-group">
                                            <select name="ceobard" class="form-control"
                                                    title="Right Breast Density Classification">
                                                <option value="-" SELECTED> -</option>
                                                <option value="1"> 1 - Almost entirely fatty</option>
                                                <option value="2"> 2 - Scattered areas of fibroglandular density
                                                </option>
                                                <option value="3"> 3 - Heterogeneously dense</option>
                                                <option value="4"> 4 - Extremely dense</option>
                                            </select>
                                        </div>
                                    </td>
                                </tr>

                                <tr>
                                    <td>Left Breast</td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("ceafa") }}
                                        </div>
                                    </td>
                                    <td style="padding-top:1px;">
                                        <div class="form-group form-inline">
                                            {{ f.checkbox("ceobafc","c","Calcification") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceobafy","y","Cyst") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceobafm","m","Mass") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceobafo","o","Other") }}&nbsp;&nbsp;
                                            <input type="text" name="ceobafos" id="ceobafos" class="form-control"
                                                   required="required" placeholder="Specify">
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">Left Breast Density Classification (BI-RADS)</td>
                                    <td>
                                        <div class="form-group">
                                            <select name="ceobald" class="form-control"
                                                    title="Left Breast Density Classification">
                                                <option value="-" SELECTED> -</option>
                                                <option value="1"> 1 - Almost entirely fatty</option>
                                                <option value="2"> 2 - Scattered areas of fibroglandular density
                                                </option>
                                                <option value="3"> 3 - Heterogeneously dense</option>
                                                <option value="4"> 4 - Extremely dense</option>
                                            </select>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <div class="form-group">
                                            <label for="ceobrc">Additional comments on breast abnormalities</label>
                                            <textarea name="ceobrc" id="ceobrc" class="form-control"></textarea>
                                            {{ f.inlineCheckbox("ceobrci", "y", "Include in impression") }}
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <hr/>
                        </div>

                        {# Bone Abnormalities #}
                        <div class="row">
                            <div class="form-group">
                                <div class="col-sm-4 col-md-3">
                                    <label for="ceaba-n">Bone abnormalities</label>
                                </div>
                                <div class="col-sm-8 col-md-9">
                                    {{ f.inlineRadioNY("ceaba") }}
                                </div>
                            </div>
                        </div>
                        <div class="row" id="bone-container" style="margin-left:1em;">
                            <div class="form-group col-sm-12">
                                <label for="ceaoabb">Specify bone abnormalities</label>
                                <textarea name="ceaoabb" id="ceaoabb" class="form-control"></textarea>
                                {{ f.inlineCheckbox("ceaoabbi", "y", "Include in impression") }}
                            </div>
                        </div>

                        {# Abdominal Abnormalities #}
                        <div class="row">
                            <div class="form-group">
                                <div class="col-sm-4 col-md-3">
                                    <label for="ceoaa-n">Abdominal abnormalities</label>
                                </div>
                                <div class="col-sm-8 col-md-9">
                                    {{ f.inlineRadio("ceoaa", "ceoaa-n","n","No",true) }}
                                    {{ f.inlineRadio("ceoaa", "ceoaa-y","y","Yes",true) }}
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive" id="abdominal-container" style="margin-left:1em;">
                            <table class="table">
                                <tbody>

                                <tr>
                                    <td>Gall Bladder</td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("ceaga") }}
                                        </div>
                                    </td>
                                    <td style="padding-top:1px;">
                                        <div class="form-group form-inline" id="ceaga-container">
                                            {{ f.checkbox("ceagh","h","Cholecystectomy") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceags","s","Stones") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceagl","l","Sludge") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceago","y","Other") }}&nbsp;&nbsp;
                                            <input type="text" name="ceagos" id="ceagos" class="form-control"
                                                   required="required"
                                                   placeholder="Specify">
                                        </div>
                                    </td>
                                </tr>

                                <tr>
                                    <td>Spleen</td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("ceasa") }}
                                        </div>
                                    </td>
                                    <td style="padding-top:1px;">
                                        <div class="form-group form-inline" id="ceasa-container">
                                            {{ f.checkbox("ceasc","y","Calcification") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceasy","y","Cyst") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceasm","m","Mass") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceaso","y","Other") }}&nbsp;&nbsp;
                                            <input type="text" name="ceasos" id="ceasos" class="form-control"
                                                   required="required"
                                                   placeholder="Specify">
                                        </div>
                                    </td>
                                </tr>

                                <tr>
                                    <td>Liver</td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("ceala") }}
                                        </div>
                                    </td>
                                    <td style="padding-top:1px;">
                                        <div class="form-group form-inline" id="ceala-container">
                                            {{ f.checkbox("cealc","y","Calcification") }}&nbsp;&nbsp;
                                            {{ f.checkbox("cealy","y","Cyst") }}&nbsp;&nbsp;
                                            {{ f.checkbox("cealm","m","Mass") }}&nbsp;&nbsp;
                                            {{ f.checkbox("cealh","h","HU < 40") }}&nbsp;&nbsp;
                                            {{ f.checkbox("cealo","y","Other") }}&nbsp;&nbsp;
                                            <input type="text" name="cealos" id="cealos" class="form-control"
                                                   required="required"
                                                   placeholder="Specify">
                                        </div>
                                    </td>
                                </tr>


                                <tr>
                                    <td>Pancreas</td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("ceapa") }}
                                        </div>
                                    </td>
                                    <td style="padding-top:1px;">
                                        <div class="form-group form-inline" id="ceapa-container">
                                            {{ f.checkbox("ceapc","y","Calcification") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceapy","y","Cyst") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceapm","m","Mass") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceapo","y","Other") }}&nbsp;&nbsp;
                                            <input type="text" name="ceapos" id="ceapos" class="form-control"
                                                   required="required"
                                                   placeholder="Specify">
                                        </div>
                                    </td>
                                </tr>

                                <tr>
                                    <td>Adrenals</td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("ceaaa") }}
                                        </div>
                                    </td>
                                    <td style="padding-top:1px;">
                                        <div class="form-group form-inline" id="ceaaa-container">
                                            {{ f.checkbox("ceaac","y","Calcification") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceaay","y","Cyst") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceaam","m","Mass") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceaao","y","Other") }}&nbsp;&nbsp;
                                            <input type="text" name="ceaaos" id="ceaaos" class="form-control"
                                                   required="required"
                                                   placeholder="Specify">
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Kidneys</td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadioNYE("ceaka") }}
                                        </div>
                                    </td>
                                    <td style="padding-top:1px;">
                                        <div class="form-group form-inline" id="ceaka-container">
                                            {{ f.checkbox("ceakc","y","Calcification") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceaky","y","Cyst") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceakm","m","Mass") }}&nbsp;&nbsp;
                                            {{ f.checkbox("ceako","y","Other") }}&nbsp;&nbsp;
                                            <input type="text" name="ceakos" id="ceakos" class="form-control"
                                                   required="required"
                                                   placeholder="Specify">
                                        </div>
                                    </td>
                                </tr>


                                <tr>
                                    <td colspan="3">
                                        <div class="form-group">
                                            <label for="ceaoab">Additional comments on abdominal abnormalities</label>
                                            <textarea name="ceaoab" id="ceaoab" class="form-control"></textarea>
                                            {{ f.inlineCheckbox("ceaoabi", "y", "Include in impression") }}
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <hr/>
                        </div>
                    </div>
                    {#  END Abnormalities tab#}

                    <div class="tab-pane" id="emphysema-coronary" role="tabpanel" aria-labelledby="emphysema-coronary-tab">

                        <div class="row">
                            <div class="col-sm-12 form-group">
                                <label class="control-label required">Emphysema</label>
                                {{ f.radio("ceem", "ceem-nv", "nv", "Not visible", true) }}
                                {{ f.radio("ceem", "ceem-no", "no", "None", false) }}
                                {{ f.radio("ceem", "ceem-mi", "mi", "Mild - splaying of vessels or scattered bulla/blebs", false) }}
                                {{ f.radio("ceem", "ceem-mo", "mo", "Moderate - less than 50%", false) }}
                                {{ f.radio("ceem", "ceem-se", "se", "Severe - more than 50%", false) }}

                            </div>
                        </div>

                        <div class="row">
                            <div class="form-group">
                                <div class="col-sm-4 col-md-3">
                                    <label for="ceoca-n">Cardiac Abnormalities</label>
                                </div>
                                <div class="col-sm-8 col-md-9">
                                    {{ f.inlineRadio("ceoca", "ceoca-n","n","No",true) }}
                                    {{ f.inlineRadio("ceoca", "ceoca-y","y","Yes",true) }}
                                </div>
                            </div>
                        </div>

                        <div class="table-responsive" id="coronary-container" style="margin-left:1em;">
                            <table class="table">
                                <tbody>
                                {% if formPage=="ctevaluation-elcap" %}
                                    <tr>
                                        <td>
                                            <label
                                                    class="control-label required"
                                                    for="cecclm">Coronary calcification</label>
                                        </td>
                                        <td>
                                            <div class="form-group">{{ f.checkbox("ceccv","e","Not visible") }}</div>
                                        </td>
                                        <td>
                                            <div class="form-group">
                                                <label for="cecclm" class="required">Left main</label>
                                                <select name="cecclm" id="cecclm" class="form-control"
                                                        required="required">
                                                    <option value=""> -</option>
                                                    <option value="no"> None</option>
                                                    <option value="mi"> Minimal < &frac13;</option>
                                                    <option value="mo"> Moderate</option>
                                                    <option value="ex"> Extensive > &frac23;</option>
                                                </select>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group">
                                                <label for="ceccld" class="required">LAD</label>
                                                <select name="ceccld" id="ceccld" class="form-control"
                                                        required="required">
                                                    <option value=""> -</option>
                                                    <option value="no"> None</option>
                                                    <option value="mi"> Minimal < &frac13;</option>
                                                    <option value="mo"> Moderate</option>
                                                    <option value="ex"> Extensive > &frac23;</option>
                                                </select>
                                            </div>
                                        </td>

                                        <td>
                                            <div class="form-group">
                                                <label for="cecccf" class="required">Circumflex</label>
                                                <select name="cecccf" id="cecccf" class="form-control"
                                                        required="required">
                                                    <option value=""> -</option>
                                                    <option value="no"> None</option>
                                                    <option value="mi"> Minimal < &frac13;</option>
                                                    <option value="mo"> Moderate</option>
                                                    <option value="ex"> Extensive > &frac23;</option>
                                                </select>
                                            </div>
                                        </td>

                                        <td>
                                            <div class="form-group">
                                                <label for="ceccrc" class="required">RCA</label>
                                                <select name="ceccrc" id="ceccrc" class="form-control"
                                                        required="required">
                                                    <option value=""> -</option>
                                                    <option value="no"> None</option>
                                                    <option value="mi"> Minimal < &frac13;</option>
                                                    <option value="mo"> Moderate</option>
                                                    <option value="ex"> Extensive > &frac23;</option>
                                                </select>
                                            </div>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td colspan="2">
                                            <label class="control-label" for="cecccac">
                                                Visual <abbr title="Coronary Artery Calcium">CAC</abbr> score
                                            </label>
                                        </td>
                                        <td colspan="5">
                                            <span id="cecccac-text"></span>
                                            <input type="hidden" name="cecccac" id="cecccac">
                                        </td>
                                    </tr>

                                {% else %}
                                    <tr>
                                        <td>
                                            <label class="control-label"
                                                   for="ceccv-n">Coronary calcification</label>
                                        </td>
                                        <td colspan="5">
                                            {{ f.inlineRadio("ceccv","ceccv-n","n","None") }}
                                            {{ f.inlineRadio("ceccv","ceccv-m","m","Mild") }}
                                            {{ f.inlineRadio("ceccv","ceccv-d","d","Moderate") }}
                                            {{ f.inlineRadio("ceccv","ceccv-s","s","Severe") }}
                                        </td>
                                    </tr>
                                {% endif %}
                                </tbody>
                            </table>
                        </div>


                    </div>

                    {# END Emphysema tab #}

                    <div class="tab-pane" id="impression" role="tabpanel" aria-labelledby="impression-tab">
                        <h3>Impression</h3>
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="alert alert-info">Annual repeat and follow-up CT scans should utilize
                                    the same low-dose protocol used for baseline low-dose CT scans.
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12 form-group">
                                <label class="required">Nodules</label>
                                <div class="radio">
                                    <label>
                                        <input type="radio" name="ceimn" id="ceimn-rs" value="rs"
                                               required="required">
                                        No evidence of nodules. Follow-up as recommended.
                                    </label>
                                </div>
                                <div class="radio">
                                    <label>
                                        <input type="radio" name="ceimn" id="ceimn-ro" value="ro"> Nodule(s) as
                                        described. Consistent with old granulomatous disease. Follow-up as recommended.
                                    </label>
                                </div>

                                <div class="radio">
                                    <label>
                                        <input type="radio" name="ceimn" id="ceimn-ru" value="ru"> Nodule(s)
                                        unchanged, as described. Follow-up as recommended.
                                    </label>
                                </div>

                                <div class="radio">
                                    <label>
                                        <input type="radio" name="ceimn" id="ceimn-nf" value="nf"> Nodule(s) as
                                        described. Follow-up as recommended.
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-12 form-group">
                                <strong>Other Findings</strong>
                                <div class="radio">
                                    <label>
                                        <input type="radio" name="ceimo" id="ceimo-no" value="no"> No other
                                        abnormalities.
                                    </label>
                                </div>
                                <div class="radio">
                                    <label>
                                        <input type="radio" name="ceimo" id="ceimn-oa" value="oa"> Other
                                        abnormalities and suggested follow-up as described above.
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12 form-group">
                                <label for="ceimre">Impression remarks</label>
                                <textarea name="ceimre" id="ceimre" class="form-control"></textarea>
                            </div>
                        </div>

                        <h3>Follow Up</h3>
                        <div class="row">
                            <div class="col-sm-3 form-group">
                                <label for="cefu">Follow up:</label>
                                <select name="cefu" id="cefu" class="form-control">
                                    <option value="-"> -</option>
                                    <option value="rs"> Annual repeat CT</option>
                                    <option value="dx"> Follow-up CT</option>
                                    <option value="af"> Abx + follow-up CT</option>
                                    <option value="pe"> PET</option>
                                    <option value="cc"> CT w contrast</option>
                                    <option value="fn"> CT-guided biopsy</option>
                                    <option value="br"> Bronchoscopy</option>
                                    <option value="su"> Resection</option>
                                    <option value="nf"> No further follow-up</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12 form-group">
                                <label for="cefuw-nw">When:</label><br/>
                                {{ f.inlineRadio("cefuw", "cefuw-nw","nw","Now") }}
                                {{ f.inlineRadio("cefuw", "cefuw-1m","1m","1 month") }}
                                {{ f.inlineRadio("cefuw", "cefuw-3m","3m","3 months") }}
                                {{ f.inlineRadio("cefuw", "cefuw-6m","6m","6 months") }}
                                {{ f.inlineRadio("cefuw", "cefuw-1y","1y","1 year") }}
                                {{ f.inlineRadio("cefuw", "cefuw-os","os","Other") }}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-3 col-md-2 form-group">
                                <label class="required" for="cefud">Approximate follow-up date:</label><br/>
                                {{ f.datepicker("cefud", "future", "Follow up date is required") }}
                            </div>
                        </div>

                        <h3>Lung-RADS</h3>
                        <div class="row">
                            <div class="form-group col-sm-5 col-md-4">
                                <label class="required" for="celrad">Category</label>
                                <br/>
                                {{ f.radio("celrad", "celrad-na","-","Not applicable", formPage == "ctevaluation") }}
                                {{ f.radio("celrad", "celrad-0","0","0 (incomplete)") }}
                                {{ f.radio("celrad", "celrad-1","1","1 (negative)") }}
                                {{ f.radio("celrad", "celrad-2","2","2 (benign appearance or behavior)") }}
                                {{ f.radio("celrad", "celrad-3","3","3 (probably benign)") }}
                                {{ f.radio("celrad", "celrad-4A","4A","4A (suspicious)") }}
                                {{ f.radio("celrad", "celrad-4B","4B","4B (suspicious)") }}
                                {{ f.radio("celrad", "celrad-4X","4X","4X (suspicious)") }}
                            </div>
                            <div class="form-group col-sm-7 col-md-8">
                                <label>Modifiers</label>
                                {{ f.checkbox("celrads", "S", "S - clinically significant or potentially clinically significant findings (non lung cancer)") }}
                                {{ f.checkbox("celradc", "C", "C - prior diagnosis of lung cancer who return to screening") }}
                            </div>
                        </div>
                    </div>   <!-- end of impression tab -->
                </div>
            </div>

            <div class="btn-group">
                <a id="delete-form" class="btn btn-danger" tabindex="1103"><span class="glyphicon glyphicon-trash"></span>Delete</a>
            </div>
            

            <div class="pull-right">
                <button type="button" class="btn btn-default btn-prev" tabindex="1104">Previous</button>
                <button type="button" class="btn btn-default btn-next" tabindex="1105">Next</button>
                <input type="hidden" name="cennod" value="0"/>
                <input type="hidden" name="ceanod" value="n"/>
                <input type="hidden" name="samistatus" value=""/>
                <button type="submit" class="btn btn-default" id="save-for-later-button" tabindex="1106">Save for Later</button>
                <button type="submit" class="btn btn-primary" id="submit-button" tabindex="1107">Submit</button>
            </div>
        </form>
    </div>

    {{ f.deleteFormModal("ctevaluation.html", mockup, formMethod)}}
{% endblock %}

{% block script %}
    <script language="JavaScript">

        //calculate Time Since Baseline (TSB)
        function calculateTimeSinceBaseline() {
            const baselineDateString = $("#sidoe").val();
            const studyDateString = $("#cedos").val();
            if (baselineDateString && studyDateString) {
                const baselineDate = moment(baselineDateString, VAPALS.DATE_FORMAT);
                const studyDate = moment(studyDateString, VAPALS.DATE_FORMAT);
                if (baselineDate.isValid() && studyDate.isValid()) {
                    const months = parseInt(studyDate.diff(baselineDate, "months", true));
                    $("#cetsb-text").text(months);
                    $("#cetsb").val(months);
                }
                else {
                    $("#cetsb-text").text("error")
                }
            }
        }

        function calculatePulmonaryArteryAortaRatio() {
            let res = 0;
            const cepaw = $("#cepaw").val(), ceaow = $("#ceaow").val();
            if (ceaow > 0) {
                res = (cepaw / ceaow).toFixed(2);
                $("#cepar-text").text(res);
                $("#cepar").val(res);
            }
            else {
                $("#cepar-text").text("");
                $("#cepar").val("");
            }
        }

        {% if formPage=="ctevaluation-elcap" %}
        function calculateVisualCacScore() {
            let cal1 = $("#cecclm")[0].selectedIndex;
            let cal2 = $("#ceccld")[0].selectedIndex;
            let cal3 = $("#cecccf")[0].selectedIndex;
            let cal4 = $("#ceccrc")[0].selectedIndex;
            if (cal1 > 0) cal1 = cal1 - 1;
            if (cal2 > 0) cal2 = cal2 - 1;
            if (cal3 > 0) cal3 = cal3 - 1;
            if (cal4 > 0) cal4 = cal4 - 1;
            const res = cal1 + cal2 + cal3 + cal4;
            $("#cecccac").val(res);
            $("#cecccac-text").text(res);
        }
        {% endif %}

        /**
         * Sets the default value of a radio group and conditionally displays a container when that radio value is "y"
         * @param radioGroupName the group of radio buttons to evaluate
         * @param defaultValue the default value of the radio when no other option is already selected.
         * @param display selector for the container to display
         * @param displayWhenValue display the `display` object when the radioGroupName value is equal to this
         */
        function defaultRadio(radioGroupName, defaultValue, display, displayWhenValue) {
            const $radios = $("input:radio[name=" + radioGroupName + "]");

            //set default if not already selected
            if ($radios.is(":checked") === false) {
                $radios.filter("[value=" + defaultValue + "]").prop('checked', true);
            }

            if (display && displayWhenValue) {
                $radios.conditionallyDisplay({sourceValues: displayWhenValue, enable: display});
            }
        }

        let noduleCount = 0;

        function addNodule() {
            if (noduleCount === 10) {
                VAPALS.displayNotification("Maximum Nodules Reached", "No more than 10 nodules are allowed. You may need to scroll to the right to see the additional nodule fields.");
            }
            else {
                displayNodules(++noduleCount);
                $("[name='cennod']").val(noduleCount);
                $("[name='ceanod']").val("y");
            }
        }

        function removeNodule() {
            if (noduleCount > 0) {
                displayNodules(--noduleCount);
                $("[name='cennod']").val(noduleCount);
                $("[name='ceanod']").val(noduleCount === 0 ? "n" : "y");
            }
        }

        function displayNodules(count) {
            $("[data-nodule-id]").hide().filter(function () {
                return $(this).data("nodule-id") <= count;
            }).show();

            // Only show the delete icon on the last (rightmost) nodule;
            // NB: there is currently no support renumbering fields so removing from the middle is not an option
            $(".remove-nodule").hide().filter(function () {
                return $(this).data("nodule-id") === count;
            }).show();

            $("#nodule-table").toggle(noduleCount > 0);
            $("#cect"+count+"ch").focus()
            $("#add-first-nodule").toggle(noduleCount === 0);
        }

        function findRadioGroupNames($container) {
            return $.unique($container.find("input[type=radio]")
                .map(function (index, element) {
                    return this.name;
                }));
        }

        $(function () {
            // SCAN
            // bind to change events on study date and baseline date to calculate "time since baseline"
            const $tsbFields = $("#sidoe, #cedos");
            $tsbFields.closest(".datepicker").on("dp.change", calculateTimeSinceBaseline); //latch onto datetimepicker change events
            $tsbFields.first().trigger("change"); //trigger on page load for existing data;

            const $cedos = $("#cedos");
            if (!$cedos.val()) {
                $cedos.val(moment().format(VAPALS.DATE_FORMAT)).trigger('change');
            }

            $("[name=cetex]").on("change", function () {
                const $sidoe = $("#sidoe");
                if ($("[name=cetex]:checked").val() === "b") { // type of exam (tex) is baseline
                    if (!$sidoe.val()) {
                        $sidoe.val($("#cedos").val()).trigger('change');
                    }
                    $("select[name^=cect][name$=ch]").val("n"); // set nodule "is it new?" to "new"
                }
            }).conditionallyEnable({sourceValues: "b", disable: "#non-baseline-container"});

            // NODULES
            {% for i in noduleArray %}
                $("#cect{{ i }}nt").conditionallyEnable({sourceValues: "m", enable: "#cect{{ i }}-container"});

                if ($("#cect{{ i }}sv").val() === "") {
                    let $fields = $("#cect{{ i }}sl, #cect{{ i }}sw, #cect{{ i }}sh");
                    $fields.on('keyup.vapals', function () {
                        const l = $("#cect{{ i }}sl").val() || 0;
                        const w = $("#cect{{ i }}sw").val() || 0;
                        const h = $("#cect{{ i }}sh").val() || 0;

                        let v
                        if (h==0) {
                            v = l * w  * Math.sqrt( l * w )
                        } else {
                            v = Math.PI * (4 / 3) * l / 2 * w / 2 * h / 2;
                        }
                        
                        $("#cect{{ i }}sv").val(v.toFixed(2));
                    });
                    $("#cect{{ i }}sv").on('keyup', function () {
                        $fields.off('change.vapals');
                    });
                }
            {% endfor %}

            $("#cectrst").conditionallyDisplay({sourceValues: "o", enable: "#cectrsto-container"});

            // Display the proper number of nodule columns based on the nodules that have a value for
            // "Endobronchial", a required field.
            const $noduleKeyFields = $("[name^=cect][name$=en]").filter(function () {
                return $(this).val() !== "" && $(this).val() !== "-";
            });


            // NB: Generally, the number of fields that have a value can be the number of nodules we display. In
            // the rare case where we persist a nodule without setting the first field (Is it new?), use the
            // lastNoduleId in the list to determine the number of nodules to display.
            const lastNoduleId = $noduleKeyFields.last().closest("[data-nodule-id]").data("nodule-id") || 0;
            noduleCount = Math.max($noduleKeyFields.length, lastNoduleId);
            displayNodules(noduleCount);


            //ABNORMALITIES
            defaultRadio("pa", "n", "#pulmonary-container", "y");
            defaultRadio("ceca", "n", "#cardiac-container", "y");
            defaultRadio("ceoma", "n", "#neck-container", "y");
            defaultRadio("ceoba", "n", "#breast-container", "y");
            defaultRadio("ceaba", "n", "#bone-container", "y");
            defaultRadio("ceoaa", "y", "#abdominal-container", "y");
            defaultRadio("ceoca", "n", "#coronary-container", "y");

            //for each of the main sections, find all the radiogroups and default them to "n" (no)
            // NB: Cardiac & Bone have no radio button groups.
            const $containers = $("#pulmonary-container, #neck-container, #breast-container, #abdominal-container");
            $.each($containers, function (i, container) {
                const groupNames = findRadioGroupNames($(container));
                $.each(groupNames, function (i, group) {
                    defaultRadio(group, "n", $("#" + group + "-container"), "y");
                });
            });


            {%  if  formPage == "ctevaluation-elcap" %}
                $("#cecclm, #ceccld, #cecccf, #ceccrc").on('change', calculateVisualCacScore);
                calculateVisualCacScore();
            {% endif %}
            $("#cepaw, #ceaow").on('keyup change', calculatePulmonaryArteryAortaRatio);
            calculatePulmonaryArteryAortaRatio();

            /**
             * Adds a formValidation validator that ensures at least one radio button in group.container has a value of
             * "y", if the parent radio (group.radio) also has a value of "y"
             * @param group the group of controls that need to be validated.
             * group.radio - the parent radio button controller
             * group.container - the jQuery container where to find all other radio
             * group.humanName - the common name for this validation group to be used in the validation error message.
             */
            function requireChildRadioSelectedValidator(group) {
                const validatorControl = $("#" + group.radio + "-n");
                const fv = $("form.validated").data("formValidation");
                if (fv) {
                    const radioGroups = findRadioGroupNames(group.container);
                    $.each(radioGroups, function (idx, groupName) {
                        const childRadios = $("[name=" + groupName + "]");
                        childRadios.on('change', function () {
                            fv.revalidateField(validatorControl);
                        });
                    });

                    fv.addField(validatorControl.attr("name"), {
                        excluded: function ($field, validator) {
                            return false;
                        },
                        validators: {
                            callback: {
                                callback: function (value, validator, $field) {
                                    let isValid = true;
                                    if ($("[name=" + group.radio + "]:checked").val() === "y") {
                                        const groupNames = findRadioGroupNames(group.container);
                                        const yeses = $.grep(groupNames, function (groupName) {
                                            return $("[name=" + groupName + "]:checked").val() === "y";
                                        });
                                        if (yeses.length === 0) {
                                            isValid = false;
                                        }
                                    }

                                    return {
                                        valid: isValid,
                                        message: "At least one " + group.humanName + " abnormality must be selected."
                                    }
                                }
                            }
                        }
                    });
                }
            }


            const groups = [
                {radio: 'ceoca', container: $("#coronary-container"), humanName: "coronary"},
                {radio: 'pa', container: $("#pulmonary-container"), humanName: "pulmonary"},
                {radio: 'ceoma', container: $("#neck-container"), humanName: "neck and mediastinal"},
                {radio: 'ceoba', container: $("#breast-container"), humanName: "breast"},
                {radio: 'ceoaa', container: $("#abdominal-container"), humanName: "abdominal"}
            ];

            for (let i = 0; i < groups.length; i++) {
                requireChildRadioSelectedValidator(groups[i])
            }

            //followup date calculation
            $("[name=cefuw]").on('change', function () {
                const when = $("[name='cefuw']:checked").val();
                switch (when) {
                    case "nw":
                        $("#cefud").val(moment().format(VAPALS.DATE_FORMAT));
                        break;
                    case "1m":
                        $("#cefud").val(moment().add(1, 'month').format(VAPALS.DATE_FORMAT));
                        break;
                    case "3m":
                        $("#cefud").val(moment().add(3, 'month').format(VAPALS.DATE_FORMAT));
                        break;
                    case "6m":
                        $("#cefud").val(moment().add(6, 'month').format(VAPALS.DATE_FORMAT));
                        break;
                    case "1y":
                        $("#cefud").val(moment().add(1, 'year').format(VAPALS.DATE_FORMAT));
                        break;
                    default:
                        $("#cefud").val("").focus();
                }
            });

            // mean diameter calculation
            const lengthFields = $("[name^=cect][name$=sl],[name^=cect][name$=sw]")
            lengthFields.on('keyup change', function (e) { 
                const targetField = $(e.target);
                const noduleId = targetField.closest("td").attr("data-nodule-id");
                const noduleDiamLabel = $("#cect"+noduleId+"sd-val");
                const wval = $("#cect"+noduleId+"sw").val();
                const lval = $("#cect"+noduleId+"sl").val();
                const w = wval ? Number(wval) : 0;
                const l = lval ? Number(lval) :  0;

                if (w>0 && l>0) {
                    const meanDiam = (l + w)/2;
                    if (meanDiam > 0 ) {
                        noduleDiamLabel.text(meanDiam.toFixed(2));
                    } else {
                        noduleDiamLabel.text("-");
                    }
                } else {
                    noduleDiamLabel.text("-");
                }
            }).first().trigger('change');



            $("form").on("submit", function (e) {
                console.log("onsubmit");

                //TODO First, validate each tab, navigate to the one that's bad; exit

                return true; //all checks passed

            });


            //WRAP IT UP
            $(".validated").formValidation({framework: 'bootstrap'});

            //at least one checkbox whose name starts with cemlnl is required if cemln==y
            const $cemlnFields = $("input[type='radio'][name='cemln']");
            const validatorControlName = 'validator-cemln';
            const $validatorControl = $("[name=" + validatorControlName + "]");
            // requireOneValidator needs to happen after formValidation is initialized
            // through ...$(".validated").formValidation(...)
            requireOneValidator($("[name^=cemlnl]"), $validatorControl);
            $cemlnFields.on("change", function () {
                const fv = $("form.validated").data("formValidation");
                if (fv) {
                    const lymphNodesEnabled = $cemlnFields.filter(":checked").val() === "y";
                    fv.enableFieldValidators(validatorControlName, lymphNodesEnabled, 'callback');
                }
            }).first().trigger('change');

            //always after formValidation initialization
            initTabbedNavigation("ctEvalTabs", "ctEvalTabsContent");

        });
    </script>

{% endblock %}