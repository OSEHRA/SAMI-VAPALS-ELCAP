{% extends 'layout.jinja2' %}
{% import 'forms.jinja2' as f %}
{% block title %}{{ title | escape }}{% endblock %}

{% block body %}
    <div class="container-fluid" style="max-width:1550px">
        <h1>
            Sample, Sammy G
            <small class="text-muted" title="Study ID">ST0001</small>
        </h1>
        <h2>Background
            <small class="text-muted" title="Medical Record Number">1234567890</small>
        </h2>

        <hr>
        <form action="{{ formPage+".html" if mockup else "/vapals" }}" method="{{ formMethod }}"
              class="validated"
              data-fv-icon-valid="glyphicon glyphicon-ok"
              data-fv-icon-invalid="glyphicon glyphicon-remove"
              data-fv-icon-validating="glyphicon glyphicon-refresh"
              data-fv-button-selector="#submit-button">
            <input type="hidden" name="samiroute" value="postform"/>
            <input type="hidden" name="studyid" value="@@SID@@"/>
            <input type="hidden" name="form" value="@@FORMKEY@@"/>
            <div>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbfc-n', 'Family history of lung cancer?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbfc") }}
                        </div>
                    </div>
                    <div id="sbfc-container" style="display: none;">
                        <div class="form-group col-sm-4 col-md-2">
                            <label class="control-label required" for="sbfcf-n">Father?</label><br/>
                            {{ f.inlineRadio("sbfcf","sbfcf-n","n", "No", true) }}
                            {{ f.inlineRadio("sbfcf","sbfcf-y","y", "Yes") }}
                        </div>
                        <div class="form-group col-sm-4 col-md-2">
                            <label class="control-label required" for="sbfcm-n">Mother?</label><br/>
                            {{ f.inlineRadio("sbfcm","sbfcm-n","n", "No", true) }}
                            {{ f.inlineRadio("sbfcm","sbfcm-y","y", "Yes") }}
                        </div>
                        <div class="form-group col-sm-4 col-md-2">
                            <label class="control-label required" for="sbfcs-n">Siblings?</label><br/>
                            {{ f.inlineRadio("sbfcs","sbfcs-n","n", "No", true) }}
                            {{ f.inlineRadio("sbfcs","sbfcs-y","y", "Yes") }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbhco-n', 'Any cancer?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbhco") }}
                        </div>
                    </div>
                    <div id="sbhco-container" style="display: none;">
                        <div class="form-group col-sm-4 col-md-2">
                            <label class="control-label required" for="sbhcdod">Year</label>
                            {{ f.yearpicker("sbhcdod", true, true, true) }}
                        </div>
                        <div class="form-group col-sm-4 col-md-2" style="vertical-align: top;">
                            <label class="control-label required" for="sbhcpbo">Primary site</label>
                            <input class="form-control input-sm" type="text" name="sbhcpbo"
                                   id="sbhcpbo" placeholder="Primary site?" required="required">
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmpa-n', 'Asthma?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmpa") }}
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7" id="sbmpa-container" style="display: none;">
                        <div class="form-group">
                            <label for="sbmpat-n" class="required">Under current treatment?</label><br/>
                            {{ f.inlineRadio("sbmpat","sbmpat-n","n", "No", true) }}
                            {{ f.inlineRadio("sbmpat","sbmpat-y","y", "Yes", true) }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmpc-n', 'Emphysema or chronic bronchitis (COPD)?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmpc") }}
                        </div>
                    </div>
                    <div class="col-sm-4 col-md-2" id="sbmpc-container" style="display: none;">
                        <div class="form-group">
                            <label class="control-label required" for="sbmpcw">Year</label>
                            {{ f.yearpicker("sbmpcw", true, true, true) }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmpht-n', 'High blood pressure?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmpht") }}
                        </div>
                    </div>
{#                    col-sm-12 col-md-6 col-lg-7#}
                    <div class="" id="sbmpht-container" style="display: none;">
                        <div class="form-group col-sm-4 col-md-2" style="vertical-align: top;">
                            <label class="form-check-inline required" for="sbmphtt-n">Treated?</label><br/>
                            {{ f.inlineRadio("sbmphtt", "sbmphtt-n", "n", "No", true) }}
                            {{ f.inlineRadio("sbmphtt", "sbmphtt-y", "y", "Yes") }}

                        </div>
                        <div class="form-group col-sm-4 col-md-2" style="vertical-align: top;">
                            <label class="control-label required" for="sbmphtsw">Year</label>
                            {{ f.yearpicker("sbmphtsw", true, true, true) }}
                        </div>
                        <div class="form-group col-sm-4 col-md-2" style="vertical-align: top;">
                            <label class="control-label required" for="sbmphthv">Highest Value</label>
                            <input class="form-control input-sm" type="text" name="sbmphthv"
                                   id="sbmphthv"
                                   placeholder="Highest Value?">
                        </div>

                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmphc-n', 'High cholesterol?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmphc") }}
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7" id="sbmphc-container" style="display: none;">
                        <div class="form-group">
                            <label class="control-label required" for="sbmphct-n">Treated?</label><br/>
                            {{ f.inlineRadio("sbmphct", "sbmphct-n", "n", "No", true) }}
                            {{ f.inlineRadio("sbmphct", "sbmphct-y", "y", "Yes") }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmpas-n', 'Had an angioplasty or stent?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmpas") }}
                        </div>
                    </div>
                    <div id="sbmpas-container" style="display: none;">
                        <div class="form-group col-sm-4 col-md-2">
                            <label class="control-label required" for="sbmpasw">Year</label>
                            {{ f.yearpicker("sbmpasw", true, true, true) }}
                        </div>
                        <div class="form-group col-sm-4 col-md-2" style="vertical-align: top;">
                            <label class="control-label required" for="sbmpast">Where Treated</label>
                            <input class="form-control input-sm" type="text" name="sbmpast" id="sbmpast"
                                   placeholder="Where treated?" required="required">
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmpmi-n', 'MI?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmpmi") }}
                        </div>
                    </div>
                    <div id="sbmpmi-container" style="display: none;">
                        <div class="form-group col-sm-4 col-md-2">
                            <label class="control-label required" for="sbmpmid">Year</label>
                            {{ f.yearpicker("sbmpmid", true, true, true) }}
                        </div>
                        <div class="form-group col-sm-4 col-md-2" >
                            <label class="control-label" for="sbmpast">Where Treated</label>
                            <input class="form-control input-sm" type="text" name="sbmpmiw" id="sbmpmiw"
                                   placeholder="Location">
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmps-n', 'Stroke?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmps") }}
                        </div>
                    </div>
                    <div id="sbmps-container" style="display: none;">
                        <div class="form-group col-sm-4 col-md-2">
                            <label class="control-label required" for="sbmpsd">Year</label>
                            {{ f.yearpicker("sbmpsd", true, true, true) }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmppv-n', 'Peripheral vascular disease (poor circulation)?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmppv") }}
                        </div>
                    </div>
                    <div id="sbmppv-container" style="display: none;">
                        <div class="form-group  col-sm-4 col-md-2">
                            <label class="control-label required" for="sbmppvd">Year</label>
                            {{ f.yearpicker("sbmppvd", true, true, true) }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmpd-n', 'Diabetes?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmpd") }}
                        </div>
                    </div>
                    <div id="sbmpd-container" style="display: none;">
                        <div class=" col-sm-4 col-md-2 form-group">
                            <label class="control-label required" for="sbmpdw">Starting at what age?</label>
                            <input class="form-control input-sm numeric" type="text" name="sbmpdw"
                                   id="sbmpdw" size="4" data-fv-integer="true" maxlength="4">
                        </div>

                        <div class=" col-sm-4 col-md-2 form-group">
                            <label class="control-label required" for="sbmpdt-n">Treated?</label><br/>
                            {{ f.inlineRadio("sbmpdt", "sbmpdt-n", "n", "No", true) }}
                            {{ f.inlineRadio("sbmpdt", "sbmpdt-y", "y", "Yes") }}
                        </div>

                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmpld-n', 'Liver disease?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmpld") }}
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7" id="sbmpld-container" style="display: none;">
                        <div class="form-group">
                            <label class="control-label required" for="sbmpldt-m">Severity?</label><br/>
                            {{ f.inlineRadio("sbmpldt", "sbmpldt-m", "m", "Mild", true) }}
                            {{ f.inlineRadio("sbmpldt", "sbmpldt-s", "s", "Severe") }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmprd-n', 'Kidney (renal) disease?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmprd") }}
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7" id="sbmprd-container" style="display: none;">
                        <div class="form-group">
                            <label class="control-label required" for="sbmprdt-m">Severity?</label> <br/>
                            {{ f.inlineRadio("sbmprdt", "sbmprdt-m", "m", "Mild", true) }}
                            {{ f.inlineRadio("sbmprdt", "sbmprdt-s", "s", "Severe") }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sblcs-n', 'Have you experienced any symptoms indicative of lung cancer?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadio("sblcs","sblcs-n","n", "No") }}
                            {{ f.inlineRadio("sblcs","sblcs-y","y", "Yes") }}
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7" id="sblcs-container" style="display: none;">
                        <div class="form-group">
                            <p><em>Check all that apply</em></p>
                            {{ f.checkbox("sbwcb", "b", "Cough producing bloody material") }}
                            {{ f.checkbox("sbwcl", "l", "Unexplained weight loss greater than 20 lbs.") }}
                            {{ f.checkbox("sbwch", "h", "Unexplained hoarseness") }}
                            {{ f.checkbox("sbwco", "o", "Other") }}
                            <input class="form-control input-sm" type="text" name="sbwcos"
                                   id="sbwcos" title="Other symptom" required="required">
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        <label for="sbact" class="control-label">When did you most recently have a chest CT?</label>
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            <select id="sbact" name="sbact" class="form-control input-sm">
                                <option value="-" selected>&mdash;</option>
                                <option value="a">Less than 6 months ago</option>
                                <option value="b">6–18 months ago</option>
                                <option value="f">18 months to 3 years ago</option>
                                <option value="c">3 years to 5 years ago</option>
                                <option value="d">Over 5 years ago</option>
                                <option value="e">Never</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7 form-inline" id="sbact-container" style="display: none;">
                        <div class="form-group">
                            <label for="sbahcl" class="control-label required">If so, where was the test done?</label>
                            <input type="text" name="sbahcl" id="sbahcl" class="form-control input-sm" required="required"/>
                        </div>

                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        <label for="sbahpft-n" class="control-label">Have you had a pulmonary function test
                            within the last five years?</label>
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadio("sbahpft","sbahpft-n","n", "No") }}
                            {{ f.inlineRadio("sbahpft","sbahpft-y","y", "Yes") }}
                        </div>
                    </div>

                    <div class="col-sm-12 col-md-6 col-lg-7 form-inline" id="sbahpft-container" style="display: none;">
                        <div class="form-group">
                            <label for="sbfev1">FEV1 (L/s)</label>
                            <input class="form-control input-sm" type="text" name="sbfev1" id="sbfev1" size="4">
                        </div>
                        <div class="form-group">
                            <label for="sbfvc">FVC (L)</label>
                            <input class="form-control input-sm" type="text" name="sbfvc" id="sbfvc" size="4">
                        </div>
                        <div class="form-group">
                            <label for="sbcop">Diffusion capacity (mL/min/mm Hg)</label>
                            <input class="form-control input-sm" type="text" name="sbcop" id="sbcop" size="4">
                        </div>
                        <div class="alert alert-info" id="ffr-message" style="display: none;">
                            FEV1/FVC (%) is <strong><span id="ffr-value"></span></strong>
                        </div>
                        <input type="hidden" name="sbffr" id="sbffr"/>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        <label for="sbaha-n" class="control-label">To your knowledge, have you been exposed
                            to asbestos?</label>
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadio("sbaha","sbaha-n","n", "No") }}
                            {{ f.inlineRadio("sbaha","sbaha-y","y", "Yes") }}
                        </div>
                    </div>


                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3">
                        <label for="sblcs-n" class="control-label">Have you ever worked in any of the
                            following?</label>
                    </div>
                    <div class="col-sm-6 col-md-9">
                        <div class="form-group">
                            {{ f.checkbox("sbahaoi", "i", "Asbestos product manufacturing") }}
                            {{ f.checkbox("sbahaoj", "j", "Auto repair") }}
                            {{ f.checkbox("sbahaoh", "h", "Building maintenance") }}
                            {{ f.checkbox("sbahaof", "f", "Chemical industry/foundary/refinery") }}
                            {{ f.checkbox("sbahaoa", "a", "Construction/demolition") }}
                            {{ f.checkbox("sbahaoe", "e", "Mining") }}
                            {{ f.checkbox("sbahaog", "g", "Nuclear industry") }}
                            {{ f.checkbox("sbahaoc", "c", "Ship construction/repair") }}
                            {{ f.checkbox("sbahaoo", "o", "Other") }}
                            <input class="form-control input-sm" type="text" name="sbahas" id="sbahas"
                                   title="Other work" required="required">
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>


            </div>
            <div class="pull-left">
                <a  id="delete-form" class="btn btn-danger ">
                    <span class="glyphicon glyphicon-trash"></span>Delete</a>
            </div>
            <div class="pull-right">
                <input type="hidden" name="samistatus" value=""/>
                <button type="submit" class="btn btn-default" id="save-for-later-button">Save for Later</button>
                <button type="submit" class="btn btn-primary" id="submit-button">Submit</button>
            </div>
        </form>
    </div>

    {{ f.deleteformModal("background.html", mockup, formMethod)}}

{% endblock %}

{% block script %}
    <script language="JavaScript">

        $(function () {
            //hook for calculating Pulmonary function test percentage (FFR)
            $("#sbfev1, #sbfvc").on('change', function () {
                var fev1 = $("#sbfev1").val();
                var fvc = $("#sbfvc").val();
                if (fev1 > 0 && fvc > 0) {
                    var ffr = Math.round(100.0 * fev1 / fvc);
                    if (ffr > 0) {
                        $("#sbffr").val(ffr);
                        $("#ffr-value").text(ffr);
                        $("#ffr-message").show();
                    }
                    else {
                        $("#sbffr").val("");
                        $("#ffr-message").hide();
                    }
                }
                else {
                    $("#ffr-message").hide();
                }
            }).first().trigger('change');

            //conditionally enabled fields
            $("[name=sbfc]").conditionallyDisplay({enable: "#sbfc-container"});
            $("[name=sbhco]").conditionallyDisplay({enable: "#sbhco-container"});
            $("[name=sbmpa]").conditionallyDisplay({enable: "#sbmpa-container"});
            $("[name=sbmpc]").conditionallyDisplay({enable: "#sbmpc-container"});
            $("[name=sbmpht]").conditionallyDisplay({enable: "#sbmpht-container"});
            $("[name=sbmphc]").conditionallyDisplay({enable: "#sbmphc-container"});
            $("[name=sbmpas]").conditionallyDisplay({enable: "#sbmpas-container"});
            $("[name=sbmpmi]").conditionallyDisplay({enable: "#sbmpmi-container"});
            $("[name=sbmps]").conditionallyDisplay({enable: "#sbmps-container"});
            $("[name=sbmppv]").conditionallyDisplay({enable: "#sbmppv-container"});
            $("[name=sbmpd]").conditionallyDisplay({enable: "#sbmpd-container"});
            $("[name=sbmpld]").conditionallyDisplay({enable: "#sbmpld-container"});
            $("[name=sbmprd]").conditionallyDisplay({enable: "#sbmprd-container"});
            $("[name=sblcs]").conditionallyDisplay({
                enable: $("#sblcs-container").find("label, input[id!=sbwcos]")
            });
            $("#sbwco").conditionallyDisplay({sourceValues: "o", enable: "#sbwcos"});
            $("[name=sbact]").conditionallyDisplay({
                sourceValues: function (actualValue) {
                    return actualValue !== '-' && actualValue !== 'e';
                }, enable: "#sbact-container"
            });
            $("[name=sbahpft]").conditionallyDisplay({enable: "#sbahpft-container"});
            $("#sbahaoo").conditionallyDisplay({sourceValues: "o", enable: "#sbahas"});

            $(".validated").formValidation({framework: 'bootstrap'});
        });

    </script>
{% endblock %}