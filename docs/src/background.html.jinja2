{% extends 'layout.jinja2' %}
{% import 'forms.jinja2' as f %}
{% block title %}{{ title | escape }}{% endblock %}

{% block body %}
    <div class="container-fluid" style="max-width:1550px">
        <h1>
            Sample, Sammy G
            <small class="text-muted" title="Study ID">ST0001</small>
        </h1>
        <h2>Background
            <small class="text-muted" title="Medical Record Number">1234567890</small>
        </h2>

        <hr>
        <form action="background.html" class="validated" method="{{ "get" if mockup else "post"  }}"
              data-fv-icon-valid="glyphicon glyphicon-ok"
              data-fv-icon-invalid="glyphicon glyphicon-remove"
              data-fv-icon-validating="glyphicon glyphicon-refresh"
              data-fv-button-selector="#submit-button">
            <div>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbfc-n', 'Family history of lung cancer?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbfc") }}
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7 form-inline" id="sbfc-container">
                        <div class="form-group">
                            <label class="control-label" for="sbfcf-n">Father?</label>
                            {{ f.inlineRadio("sbfcf","sbfcf-n","n", "No") }}
                            {{ f.inlineRadio("sbfcf","sbfcf-y","y", "Yes") }}
                        </div>
                        <div class="form-group">
                            <label class="control-label" for="sbfcm-n"
                                   style="padding-left:15px;">Mother?</label>
                            {{ f.inlineRadio("sbfcm","sbfcm-n","n", "No") }}
                            {{ f.inlineRadio("sbfcm","sbfcm-y","y", "Yes") }}
                        </div>
                        <div class="form-group">
                            <label class="control-label" for="sbfcs-n"
                                   style="padding-left:15px;">Siblings?</label>
                            {{ f.inlineRadio("sbfcs","sbfcs-n","n", "No") }}
                            {{ f.inlineRadio("sbfcs","sbfcs-y","y", "Yes") }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbhco-n', 'Any Cancer?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbhco") }}
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7 form-inline" id="sbhco-container">
                        <div class="form-group">
                            {{ f.yearpicker("sbhcdod", true, true, true) }}
                        </div>
                        <div class="form-group" style="vertical-align: top;">
                            <input class="form-control input-sm" type="text" name="sbhcpbo"
                                   id="sbhcpbo" placeholder="Primary site?" required="required">
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmpa-n', 'Asthma?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmpa") }}
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7 form-inline" id="sbmpa-container">
                        <div class="form-group">
                            <label for="sbmpat-n" class="">Under current treatment?</label>
                            {{ f.inlineRadio("sbmpat","sbmpat-n","n", "No", true) }}
                            {{ f.inlineRadio("sbmpat","sbmpat-y","y", "Yes", true) }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmpc-n', 'Emphysema or Chronic Bronchitis (COPD)?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmpc") }}
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7 form-inline" id="sbmpc-container">
                        <div class="form-group">
                            {{ f.yearpicker("sbmpcw", true, true, true) }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmpht-n', 'High Blood Pressure?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmpht") }}
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7 form-inline" id="sbmpht-container">
                        <div class="form-group" style="vertical-align: top;">
                            <label class="form-check-inline" for="sbmphtt-n">Treated?</label>
                            {{ f.inlineRadio("sbmphtt", "sbmphtt-n", "n", "No") }}
                            {{ f.inlineRadio("sbmphtt", "sbmphtt-y", "y", "Yes") }}
                        </div>
                        <div class="form-group" style="vertical-align: top;margin-left:10px;">
                            {# TODO: set max year#}
                            <input class="form-control input-sm numeric" type="text" name="sbmphtsw"
                                   id="sbmphtsw" placeholder="Since (year)?" required="required"
                                   data-fv-integer="true" maxlength="4">

                        </div>
                        <div class="form-group" style="vertical-align: top;">
                            <input class="form-control input-sm" type="text" name="sbmphthv"
                                   id="sbmphthv"
                                   placeholder="Highest Value?">
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmphc-n', 'High Cholesterol?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmphc") }}
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7 form-inline" id="sbmphc-container">
                        <div class="form-group">
                            <label class="control-label" for="sbmphct-n">Treated?</label>
                            {{ f.inlineRadio("sbmphct", "sbmphct-n", "n", "No") }}
                            {{ f.inlineRadio("sbmphct", "sbmphct-y", "y", "Yes") }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmpas-n', 'Had an angioplasty or Stent?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmpas") }}
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7 form-inline" id="sbmpas-container">
                        <div class="form-group">
                            {{ f.yearpicker("sbmpasw", true, true, true) }}
                        </div>
                        <div class="form-group" style="vertical-align: top;">
                            <input class="form-control input-sm" type="text" name="sbmpast" id="sbmpast"
                                   placeholder="Where treated?" required="required">
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmpmi-n', 'MI?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmpmi") }}
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7 form-inline" id="sbmpmi-container">
                        <div class="form-group">
                            {{ f.yearpicker("sbmpmid", true, true, true) }}
                        </div>
                        <div class="">
                            <input class="form-control input-sm" type="text" name="sbmpmiw" id="sbmpmiw"
                                   placeholder="Where treated?">
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmps-n', 'Stroke?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmps") }}
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7 form-inline" id="sbmps-container">
                        <div class="form-group">
                            {{ f.yearpicker("sbmpsd", true, true, true) }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmppv-n', 'Peripheral Vascular Disease (Poor Circulation)?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmppv") }}
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7 form-inline" id="sbmppv-container">
                        <div class="form-group">
                            {{ f.yearpicker("sbmppvd", true, true, true) }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmpd-n', 'Diabetes?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmpd") }}
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7 form-inline" id="sbmpd-container">
                        <div class="form-group form-inline">
                            <label class="control-label" for="sbmpdw">Starting at what age?</label>
                            <input class="form-control input-sm numeric" type="text" name="sbmpdw"
                                   id="sbmpdw" size="4" data-fv-integer="true" maxlength="4">
                        </div>

                        <div class="form-group" style="padding-left:10px;">
                            <label class="control-label" for="sbmpdt-n">Treated?</label>
                            {{ f.inlineRadio("sbmpdt", "sbmpdt-n", "n", "No") }}
                            {{ f.inlineRadio("sbmpdt", "sbmpdt-y", "y", "Yes") }}
                        </div>

                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmpld-n', 'Liver Disease?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmpld") }}
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7 form-inline" id="sbmpld-container">
                        <div class="form-group">
                            <label class="control-label" for="sbmpldt-m">Severity?</label>
                            {{ f.inlineRadio("sbmpldt", "sbmpldt-m", "m", "Mild") }}
                            {{ f.inlineRadio("sbmpldt", "sbmpldt-s", "s", "Severe") }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sbmprd-n', 'Kidney (Renal) Disease?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadioNYQ("sbmprd") }}
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7 form-inline" id="sbmprd-container">
                        <div class="form-group">
                            <label class="control-label" for="sbmprdt-m">Severity?</label>
                            {{ f.inlineRadio("sbmprdt", "sbmprdt-m", "m", "Mild") }}
                            {{ f.inlineRadio("sbmprdt", "sbmprdt-s", "s", "Severe") }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        {{ f.floatingLabel('sblcs-n', 'Have you experienced any symptoms indicative of lung cancer?') }}
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadio("sblcs","sblcs-n","n", "No") }}
                            {{ f.inlineRadio("sblcs","sblcs-y","y", "Yes") }}
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7" id="sblcs-container">
                        <div class="form-group">
                            <p><em>Check all that apply</em></p>
                            {{ f.checkbox("sbwcb", "b", "cough producing bloody material") }}
                            {{ f.checkbox("sbwcl", "l", "unexplained weight loss greater than 20 lbs.") }}
                            {{ f.checkbox("sbwch", "h", "unexplained hoarseness") }}
                            {{ f.checkbox("sbwco", "o", "other") }}
                            <input class="form-control input-sm" type="text" name="sbwcos"
                                   id="sbwcos" title="Other symptom" required="required">
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        <label for="sbact" class="control-label">When did you most recently have a chest
                            CT?</label>
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            <select id="sbact" name="sbact" class="form-control input-sm">
                                <option value="-" selected>&mdash;</option>
                                <option value="a">less than 6 months ago</option>
                                <option value="b">6–18 months ago</option>
                                <option value="f">18 months to 3 years ago</option>
                                <option value="c">3 years to 5 years ago</option>
                                <option value="d">over 5 years ago</option>
                                <option value="e">never</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7 form-inline" id="sbact-container">
                        <div class="form-group">
                            <label for="sbahcl">If so, where was the test done?</label>
                            <input type="text" name="sbahcl" id="sbahcl" class="form-control input-sm"/>
                        </div>

                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        <label for="sbahpft-n" class="control-label">Have you had a pulmonary function test
                            within the last five years?</label>
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadio("sbahpft","sbahpft-n","n", "No") }}
                            {{ f.inlineRadio("sbahpft","sbahpft-y","y", "Yes") }}
                        </div>
                    </div>

                    <div class="col-sm-12 col-md-6 col-lg-7 form-inline" id="sbahpft-container">
                        <div class="form-group">
                            <label for="sbfev1">FEV1 (L/s)</label>
                            <input class="form-control input-sm" type="text" name="sbfev1" id="sbfev1" size="4">
                        </div>
                        <div class="form-group">
                            <label for="sbfvc">FVC (L)</label>
                            <input class="form-control input-sm" type="text" name="sbfvc" id="sbfvc" size="4">
                        </div>
                        <div class="form-group">
                            <label for="sbcop">Diffusion Capacity (mL/min/mm Hg)</label>
                            <input class="form-control input-sm" type="text" name="sbcop" id="sbcop" size="4">
                        </div>
                        <div class="alert alert-info" id="ffr-message" style="display: none;">
                            FEV1/FVC (%) is <strong><span id="ffr-value"></span></strong>
                        </div>
                        <input type="hidden" name="sbffr" id="sbffr"/>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3 col-lg-3">
                        <label for="sbaha-n" class="control-label">To your knowledge, have you been exposed
                            to asbestos?</label>
                    </div>
                    <div class="col-sm-6 col-md-3 col-lg-2">
                        <div class="form-group">
                            {{ f.inlineRadio("sbaha","sbaha-n","n", "No") }}
                            {{ f.inlineRadio("sbaha","sbaha-y","y", "Yes") }}
                        </div>
                    </div>


                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-sm-6 col-md-3">
                        <label for="sblcs-n" class="control-label">Have you ever worked in any of the
                            following?</label>
                    </div>
                    <div class="col-sm-6 col-md-9">
                        <div class="form-group">
                            {{ f.checkbox("sbahaoi", "i", "asbestos product manufacturing") }}
                            {{ f.checkbox("sbahaoj", "j", "auto repair") }}
                            {{ f.checkbox("sbahaoh", "h", "building maintenance") }}
                            {{ f.checkbox("sbahaof", "f", "chemical industry/foundary/refinery") }}
                            {{ f.checkbox("sbahaoa", "a", "construction/demolition") }}
                            {{ f.checkbox("sbahaoe", "e", "mining") }}
                            {{ f.checkbox("sbahaog", "g", "nuclear industry") }}
                            {{ f.checkbox("sbahaoc", "c", "ship construction/repair") }}
                            {{ f.checkbox("sbahaoo", "o", "other") }}
                            <input class="form-control input-sm" type="text" name="sbahas" id="sbahas"
                                   title="Other work" required="required">
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>


            </div>
            <div class="pull-right">
                <input type="hidden" name="samistatus" value=""/>
                <button type="submit" class="btn btn-default" id="save-for-later-button">Save for Later</button>
                <button type="submit" class="btn btn-primary" id="submit-button">Submit</button>
            </div>
        </form>
    </div>

{% endblock %}

{% block script %}
    <script language="JavaScript">

        $(function () {
            //hook for calculating Pulmonary function test percentage (FFR)
            $("#sbfev1, #sbfvc").on('change', function () {
                var fev1 = $("#sbfev1").val();
                var fvc = $("#sbfvc").val();
                if (fev1 > 0 && fvc > 0) {
                    var ffr = Math.round(100.0 * fev1 / fvc);
                    if (ffr > 0) {
                        $("#sbffr").val(ffr);
                        $("#ffr-value").text(ffr);
                        $("#ffr-message").show();
                    }
                    else {
                        $("#sbffr").val("");
                        $("#ffr-message").hide();
                    }
                }
                else {
                    $("#ffr-message").hide();
                }
            }).first().trigger('change');

            //conditionally enabled fields
            $("[name=sbfc]").conditionallyEnable({enable: "#sbfc-container"});
            $("[name=sbhco]").conditionallyEnable({enable: "#sbhco-container"});
            $("[name=sbmpa]").conditionallyEnable({enable: "#sbmpa-container"});
            $("[name=sbmpc]").conditionallyEnable({enable: "#sbmpc-container"});
            $("[name=sbmpht]").conditionallyEnable({enable: "#sbmpht-container"});
            $("[name=sbmphc]").conditionallyEnable({enable: "#sbmphc-container"});
            $("[name=sbmpas]").conditionallyEnable({enable: "#sbmpas-container"});
            $("[name=sbmpmi]").conditionallyEnable({enable: "#sbmpmi-container"});
            $("[name=sbmps]").conditionallyEnable({enable: "#sbmps-container"});
            $("[name=sbmppv]").conditionallyEnable({enable: "#sbmppv-container"});
            $("[name=sbmpd]").conditionallyEnable({enable: "#sbmpd-container"});
            $("[name=sbmpld]").conditionallyEnable({enable: "#sbmpld-container"});
            $("[name=sbmprd]").conditionallyEnable({enable: "#sbmprd-container"});
            $("[name=sblcs]").conditionallyEnable({
                enable: $("#sblcs-container").find("label, input[id!=sbwcos]")
            });
            $("#sbwco").conditionallyEnable({sourceValues: "o", enable: "#sbwcos"});
            $("[name=sbact]").conditionallyEnable({
                sourceValues: function (actualValue) {
                    return actualValue !== '-' && actualValue !== 'e';
                }, enable: "#sbact-container"
            });
            $("[name=sbahpft]").conditionallyEnable({enable: "#sbahpft-container"});
            $("#sbahaoo").conditionallyEnable({sourceValues: "o", enable: "#sbahas"});

        });

    </script>
{% endblock %}