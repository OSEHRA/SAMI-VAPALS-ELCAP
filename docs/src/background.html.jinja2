{% extends 'layout.jinja2' %}
{% import 'forms.jinja2' as f %}
{% block title %}{{ title | escape }}{% endblock %}

{% block body %}
    <div class="container-fluid" style="max-width:1550px">
        <h1>
            Sample, Sammy G
            <small class="text-muted" title="Study ID">ST0001</small>
        </h1>
        <h2>Background
            <small class="text-muted" title="Medical Record Number">1234567890</small>
        </h2>

        <hr>
        <form action="background.html" class="validated" method="post"
              data-fv-icon-valid="glyphicon glyphicon-ok"
              data-fv-icon-invalid="glyphicon glyphicon-remove"
              data-fv-icon-validating="glyphicon glyphicon-refresh"
              data-fv-button-selector="#submit-button">
            <div>
                <div class="row">
                    <div class="col-md-6">
                        {{ f.floatingLabel('sbsru-n', 'Have you smoked at least 100 cigarettes in your lifetime? (100 cigarettes = 5 packs)') }}
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            {{ f.inlineRadio("sbsru","sbsru-n","n","No",true) }}
                            {{ f.inlineRadio("sbsru","sbsru-y","y","Yes",true) }}
                        </div>

                        <div class="form-group" id="sbsru-container">
                            <label for="sbsru-n" class="control-label">Were you exposed to secondhand smoke?</label>
                            {{ f.inlineRadio("sbsruyn","sbsruyn-n","n","No",true) }}
                            {{ f.inlineRadio("sbsruyn","sbsruyn-y","y","Yes",true) }}
                        </div>
                    </div>

                </div>
                <hr class="visible-xs-block visible-sm-block"/>


                <div class="row">
                    <div class="col-md-6">
                        {{ f.floatingLabel('sbsas', 'About how old were you when you first started smoking cigarettes regularly?') }}
                    </div>
                    <div class="col-md-6">
                        <div class="form-group form-inline">
                            <input class="form-control input-sm numeric" type="text" name="sbsas" id="sbsas"
                                   size="5">
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-md-6">
                        {{ f.floatingLabel('sbshsa-n', 'Over the past month, have you smoked at all, even one cigarette?') }}
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            {{ f.inlineRadio("sbshsa","sbshsa-n","n","No",true) }}
                            {{ f.inlineRadio("sbshsa","sbshsa-y","y","Yes",true) }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div id="non-smoking-container">
                    <div class="row">
                        <div class="col-md-6">
                            {{ f.floatingLabel('sbsdlcd', 'If no, when was the date of your last cigarette?') }}
                        </div>
                        <div class="col-md-6">
                            <div class="form-group" style="float:left;">
                                <select class="form-control input-sm" id="sbsdlcd" name="sbsdlcd"
                                        title="Last cigarette day">
                                    <option value="-" selected>&mdash;</option>
                                    {% for i in range(0,31) %}
                                        <option value="{{ i + 1 }}">{{ i + 1 }}</option>
                                    {% endfor %}
                                </select>
                                <span class="small text-muted">Day</span>
                            </div>
                            <div class="form-group" style="float:left;">
                                <select class="form-control input-sm" id="sbsdlcm" name="sbsdlcm"
                                        title="Last cigarette month">
                                    <option value="-" selected>&mdash;</option>
                                    <option value="1">Jan</option>
                                    <option value="2">Feb</option>
                                    <option value="3">Mar</option>
                                    <option value="4">Apr</option>
                                    <option value="5">May</option>
                                    <option value="6">Jun</option>
                                    <option value="7">Jul</option>
                                    <option value="8">Aug</option>
                                    <option value="9">Sep</option>
                                    <option value="10">Oct</option>
                                    <option value="11">Nov</option>
                                    <option value="12">Dec</option>
                                </select>
                                <span class="small text-muted">Month</span>
                            </div>
                            <div class="form-group" style="float:left;">
                                {{ f.yearpicker("sbsdlcy", true, true, true, "Year") }}
                            </div>
                            <div class="alert alert-info" id="sbsdlc-message"
                                 style="display: none; float:left;margin-left: 5px;">
                                Number of years since quit: <strong><span id="sbsdlc-value"></span></strong>
                            </div>
                        </div>
                    </div>
                    <hr class="visible-xs-block visible-sm-block"/>

                    <div class="row">
                        <div class="col-md-6">
                            {{ f.floatingLabel('sbfdpw', 'When you were a smoker, on approximately how many days per week did you smoke cigarettes?') }}
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-inline">
                                <input class="form-control input-sm numeric" type="text" name="sbfdpw" id="sbfdpw"
                                       size="5" data-fv-lessthan="true" data-fv-lessthan-value="7">
                            </div>
                        </div>
                    </div>
                    <hr class="visible-xs-block visible-sm-block"/>

                    <div class="row">
                        <div class="col-md-6">
                            {{ f.floatingLabel('sbfppd', 'On the days that you did smoke, approximately how many packs of cigarettes did you smoke per day (PPD)?') }}
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-inline">
                                <input class="form-control input-sm" type="text" name="sbfppd" id="sbfppd" size="5">
                            </div>
                        </div>
                    </div>
                    <hr class="visible-xs-block visible-sm-block"/>

                    <div class="row">
                        <div class="col-md-6">
                            {{ f.floatingLabel('sbfdur', 'For approximately how many years did you smoke this amount?') }}
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-inline">
                                <input class="form-control input-sm numeric" type="text" name="sbfdur" id="sbfdur"
                                       size="5">
                            </div>
                        </div>
                    </div>
                    <hr class="visible-xs-block visible-sm-block"/>
                </div>

                <div id="smoking-container">
                    <div class="row">
                        <div class="col-md-6">
                            {{ f.floatingLabel('sbcdpw', 'On average, on how many days per week do you (or did you) smoke cigarettes?') }}
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-inline">
                                <input class="form-control input-sm numeric" type="text" name="sbcdpw" id="sbcdpw"
                                       size="5" data-fv-lessthan="true" data-fv-lessthan-value="7">
                            </div>
                        </div>
                    </div>
                    <hr class="visible-xs-block visible-sm-block"/>

                    <div class="row">
                        <div class="col-md-6">
                            {{ f.floatingLabel('sbcppd', 'On average, how many packs ofcigarettes do you (or did you) smoke per day (PPD)?') }}
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-inline">
                                <input class="form-control input-sm numeric" type="text" name="sbcppd" id="sbcppd"
                                       size="5">
                            </div>
                        </div>
                    </div>
                    <hr class="visible-xs-block visible-sm-block"/>

                    <div class="row">
                        <div class="col-md-6">
                            {{ f.floatingLabel('sbcdur', 'For approximately how many years have you smoked this amount?') }}
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-inline">
                                <input class="form-control input-sm numeric" type="text" name="sbcdur" id="sbcdur"
                                       size="5">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 col-sm-offset-6 col-lg-offset-">
                            <input type="hidden" name="sbntpy" value=""/>
                            <div class="alert alert-info" id="sbntpy-message" style="display: none;">
                                <strong><span id="sbntpy-value"></span> total pack-years</strong>
                                <i class="fa fa-question-circle-o" aria-hidden="true" data-toggle="popover"
                                   title="Pack-Years calculation"
                                   data-content="Pack-Years is calculated by multiplying the average number of packs
                                   per day by the number of years smoking. For example: a person who has smoked 15
                                   cigarettes a day for 40 years has a (15/20) x 40 = 30 pack-year smoking history."></i>
                            </div>
                        </div>
                    </div>
                    <hr class="visible-xs-block visible-sm-block"/>

                    <div class="row">
                        <div class="col-md-6">
                            {{ f.floatingLabel('sbqttq-n', 'Have you ever tried to quit smoking?') }}
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                {{ f.inlineRadio("sbqttq","sbqttq-n","n","No",true) }}
                                {{ f.inlineRadio("sbqttq","sbqttq-y","y","Yes",true) }}
                            </div>
                            <div class="form-group" id="sbqttq-container">
                                <label for="sbqttqtb" class="control-label">How many times?</label>
                                <select id="sbqttqtb" name="sbqttqtb" class="form-control input-sm">
                                    <option value="-" selected>&mdash;</option>
                                    <option value="a">1</option>
                                    <option value="b">2–5</option>
                                    <option value="c">6–10</option>
                                    <option value="d">10+</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <hr class="visible-xs-block visible-sm-block"/>

                    <div class="row" id="sbqly2-container">
                        <div class="col-md-6">
                            {{ f.floatingLabel('sbqly2', 'In the last 12 months, how many times have you quit smoking for at least 24 hours?') }}
                        </div>
                        <div class="form-group col-md-6">
                            <select id="sbqly2" name="sbqly2" class="form-control input-sm">
                                <option value="-" selected>&mdash;</option>
                                <option value="e">0</option>
                                <option value="a">1</option>
                                <option value="b">2–5</option>
                                <option value="c">6–10</option>
                                <option value="d">10+</option>
                            </select>
                        </div>
                    </div>
                    <hr class="visible-xs-block visible-sm-block"/>

                    <div class="row">
                        <div class="col-md-6">
                            {{ f.floatingLabel('sbqst', 'Are you seriously thinking of quitting smoking?') }}
                        </div>
                        <div class="form-group col-md-6">
                            <select id="sbqst" name="sbqst" class="form-control input-sm">
                                <option value="-" selected>&mdash;</option>
                                <option value="y">yes, within the next 30 days</option>
                                <option value="m">yes, within the next six months</option>
                                <option value="n">no, not thinking of quitting</option>
                            </select>
                        </div>
                    </div>
                    <hr class="visible-xs-block visible-sm-block"/>

                    <div class="row">
                        <div class="col-md-6">
                            {{ f.floatingLabel('sbcpd-n', 'Smoking cessation information or counseling was offered to subject') }}
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                {{ f.inlineRadio("sbcpd","sbcpd-n","n","No",true) }}
                                {{ f.inlineRadio("sbcpd","sbcpd-y","y","Yes",true) }}
                            </div>
                        </div>
                    </div>
                    <hr class="visible-xs-block visible-sm-block"/>
                </div>


                <div class="row">
                    <div class="col-md-6">
                        {{ f.floatingLabel('sbsews-n', 'After age 18, did you work for more than one year in a worksite where smoking was allowed?') }}
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            {{ f.inlineRadio("sbsews","sbsews-n","n","No",true) }}
                            {{ f.inlineRadio("sbsews","sbsews-y","y","Yes",true) }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-md-6">
                        {{ f.floatingLabel('sbsehs-n', 'Did you ever work for more than one year in a job where you were exposed to other people’s tobacco smoke?') }}
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            {{ f.inlineRadio("sbsehs","sbsehs-n","n","No",true) }}
                            {{ f.inlineRadio("sbsehs","sbsehs-y","y","Yes",true) }}
                        </div>
                    </div>
                </div>

                <div class="row" id="sbsehs-container">
                    <hr class="visible-xs-block visible-sm-block"/>
                    <div class="col-md-12">
                        <label>List the occasions from the most recent:</label>
                        <table class="table">
                            <thead class="thead-light">
                            <tr>
                                <th scope="col">Age Range</th>
                                <th scope="col">Job</th>
                                <th scope="col">Smoking</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for i in range(0,4) %}
                                {% set j = i + 1 %}
                                <tr>
                                    <td><input type="text" name="sbsehsa{{ j }}" class="form-control"
                                               title="Age Range {{ j }}"/>
                                    </td>
                                    <td><input type="text" name="sbsehsj{{ j }}" class="form-control"
                                               title="Job {{ j }}"/></td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadio("sbsehsr"+j|string,"sbsehsr"+j|string+"-n","n","not permitted",true) }}
                                            {{ f.inlineRadio("sbsehsr"+j|string,"sbsehsr"+j|string+"-r","r","restricted",true) }}
                                            {{ f.inlineRadio("sbsehsr"+j|string,"sbsehsr"+j|string+"-y","y","allowed anywhere",true) }}
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>

                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-md-6">
                        {{ f.floatingLabel('sbhsy-n', 'Did anyone in your house smoke in the home while you were under 18?') }}
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            {{ f.inlineRadio("sbhsy","sbhsy-n","n","No",true) }}
                            {{ f.inlineRadio("sbhsy","sbhsy-y","y","Yes",true) }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-md-6">
                        {{ f.floatingLabel('sbhsyh-n', 'Was smoking allowed inside the house?') }}
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            {{ f.inlineRadio("sbhsyh","sbhsyh-n","n","Not permitted",true) }}
                            {{ f.inlineRadio("sbhsyh","sbhsyh-r","r","Resticted",true) }}
                            {{ f.inlineRadio("sbhsyh","sbhsyh-y","y","Yes",true) }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-md-6">
                        {{ f.floatingLabel('sbmsy-n', 'Did your mother/primary caregiver smoke when you were under age 7?') }}
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            {{ f.inlineRadio("sbmsy","sbmsy-n","n","No",true) }}
                            {{ f.inlineRadio("sbmsy","sbmsy-y","y","Yes",true) }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-md-6">
                        {{ f.floatingLabel('sbmst-n', 'Did your mother/primary caregiver smoke when you were ages 7–18?') }}
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            {{ f.inlineRadio("sbmst","sbmst-n","n","No",true) }}
                            {{ f.inlineRadio("sbmst","sbmst-y","y","Yes",true) }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-md-6">
                        {{ f.floatingLabel('sbosy-n', 'Did anyone else beside your mother/primary caregiver smoke in the home when you were under 18?') }}
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            {{ f.inlineRadio("sbosy","sbosy-n","n","No",true) }}
                            {{ f.inlineRadio("sbosy","sbosy-y","y","Yes",true) }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-md-6">
                        {{ f.floatingLabel('sbslws-n', 'Do you currently live with a smoker?') }}
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            {{ f.inlineRadio("sbslws","sbslws-n","n","No",true) }}
                            {{ f.inlineRadio("sbslws","sbslws-y","y","Yes",true) }}
                        </div>
                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>

                <div class="row">
                    <div class="col-md-6">
                        {{ f.floatingLabel('sbhso-n', 'After age 18, did you live with someone for more than one year who smoked in your presence?') }}
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            {{ f.inlineRadio("sbhso","sbhso-n","n","No",true) }}
                            {{ f.inlineRadio("sbhso","sbhso-y","y","Yes",true) }}
                        </div>
                    </div>
                </div>

                <div class="row" id="sbhso-container">
                    <hr class="visible-xs-block visible-sm-block"/>
                    <div class="col-md-12">
                        <label>
                            If yes, at what ages did you live with someone who smoked around you and how much
                            did they smoke? (List the occasions from the most recent)
                        </label>
                        <table class="table ">
                            <thead>
                            <tr>
                                <th scope="col">Age Range</th>
                                <th scope="col">Amount</th>
                                <th scope="col">Smoking</th>
                            </tr>
                            </thead>
                            <tbody>

                            {% for i in range(0,4) %}
                                {% set j = i + 1 %}
                                <tr>
                                    <td><input type="text" name="sbhsa{{ j }}" class="form-control"
                                               title="Age Range {{ j }}"/></td>
                                    <td>
                                        <select name="sbhsas{{ j }}" class="form-control"
                                                title="Amount {{ j }}">
                                            <option value="-">&mdash;</option>
                                            <option value="a">1–14 cigarettes a day</option>
                                            <option value="b">15–24 cigarettes a day</option>
                                            <option value="c">25+ cigarettes a day</option>
                                            <option value="d">Don’t know</option>
                                        </select>
                                    </td>
                                    <td>
                                        <div class="form-group">
                                            {{ f.inlineRadio("sbhsasr"+j|string,"sbhsasr"+j|string+"-n","n","not permitted",true) }}
                                            {{ f.inlineRadio("sbhsasr"+j|string,"sbhsasr"+j|string+"-r","r","restricted",true) }}
                                            {{ f.inlineRadio("sbhsasr"+j|string,"sbhsasr"+j|string+"-y","y","allowed anywhere",true) }}
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>

                    </div>
                </div>
                <hr class="visible-xs-block visible-sm-block"/>
            </div>
            <div class="pull-right">
                <input type="hidden" name="samistatus" value=""/>
                <button type="submit" class="btn btn-default" id="save-for-later-button">Save for Later</button>
                <button type="submit" class="btn btn-primary" id="submit-button">Submit</button>
            </div>
        </form>
    </div>

{% endblock %}

{% block script %}
    <script language="JavaScript">

        // Intentionally not run after page load so tab doesn't show then dissapear.
        $(function () {

            //hook for years since quit
            $("[name^=sbsdlc]").on('change', function () {
                var now = moment();
                var m = (parseInt($("#sbsdlcm").val()) - 1) || now.month();
                var d = parseInt($("#sbsdlcd").val()) || now.date();
                var y = parseInt($("#sbsdlcy").val()) || now.year();
                var quitDate = moment({month: m, date: d, year: y});
                var durationYears = now.diff(quitDate, 'years', true).toFixed(1);
                if (durationYears > 0) {
                    $("#sbsdlc-value").text(durationYears);
                    $("#sbsdlc-message").show();
                }
                else {
                    $("#sbsdlc-value").text("");
                    $("#sbsdlc-message").hide();
                }
            }).first().trigger('change');

            //hook for pack years calculation
            $("[name='sbcdpw'],[name='sbcppd'],[name='sbcdur']").on('change', function () {
                var daysPerWeek = $("[name='sbcdpw']").val(),
                    packsPerDay = $("[name='sbcppd']").val(),
                    years = $("[name='sbcdur']").val(),
                    totalPackYears;
                if (daysPerWeek && packsPerDay && years) {
                    var packsPerYear = packsPerDay * (daysPerWeek / 7.0);
                    totalPackYears = (packsPerYear * years).toFixed(1);
                    $("[name='sbntpy']").val(totalPackYears);
                    $("#sbntpy-value").text(totalPackYears);
                    $("#sbntpy-message").show();
                } else {
                    $("[name='sbntpy']").val("");
                    $("#sbntpy-value").text("");
                    $("#sbntpy-message").hide();
                }
            }).first().trigger('change');

            //conditionally enabled fields
            $("[name=sbsru]").conditionallyEnable({sourceValues: "n", enable: "#sbsru-container"});
            $("[name=sbqttq]").conditionallyEnable({
                enable: "#sbqttq-container, #sbqly2-container"
            });
            $("[name=sbhso]").conditionallyEnable({enable: "#sbhso-container"});
            $("[name=sbshsa]").conditionallyEnable({
                enable: "#smoking-container",
                disable: "#non-smoking-container"
            });
            $("[name=sbsehs]").conditionallyEnable({enable: "#sbsehs-container"});

            //Initialize Form Validation
            $(".validated").formValidation({framework: 'bootstrap'});

        });

    </script>
{% endblock %}